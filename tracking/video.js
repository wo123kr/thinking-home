/**
 * ÎπÑÎîîÏò§ Ï∂îÏ†Å Î™®Îìà (YouTube API ÌôúÏö©) - ÎèôÏ†Å ÏÑ§Ï†ï Í∞ÄÎä•Ìïú Íµ¨Ï°∞
 */

// ÎπÑÎîîÏò§ ÏÑ∏ÏÖò Ï∂îÏ†ÅÏùÑ ÏúÑÌïú Î≥ÄÏàòÎì§
let videoSessions = new Map(); // Í∞Å ÎπÑÎîîÏò§Î≥Ñ ÏÑ∏ÏÖò Ï∂îÏ†Å
let isVideoTrackingInitialized = false;

function trackVideoEvents() {
  console.log('üé¨ ÎπÑÎîîÏò§ Ï∂îÏ†Å Ï¥àÍ∏∞Ìôî ÏãúÏûë...');
  
  // Ï§ëÎ≥µ Ï¥àÍ∏∞Ìôî Î∞©ÏßÄ
  if (isVideoTrackingInitialized) {
    console.log('‚ÑπÔ∏è ÎπÑÎîîÏò§ Ï∂îÏ†ÅÏù¥ Ïù¥ÎØ∏ Ï¥àÍ∏∞ÌôîÎê®');
    return;
  }
  
  // ThinkingData SDK ÌôïÏù∏
  if (typeof window.te === 'undefined') {
    console.warn('‚ö†Ô∏è ThinkingData SDKÍ∞Ä Î°úÎìúÎêòÏßÄ ÏïäÏùå, 3Ï¥à ÌõÑ Ïû¨ÏãúÎèÑ...');
    setTimeout(trackVideoEvents, 3000);
    return;
  }
  
  // ÎèôÏ†Å ÎπÑÎîîÏò§ ÌîåÎû´Ìèº Í∞êÏßÄ
  const videoIframes = detectVideoIframes();
  console.log(`üéØ ÎπÑÎîîÏò§ iframe Î∞úÍ≤¨: ${videoIframes.length}Í∞ú`);
  
  if (videoIframes.length > 0) {
    // YouTube API Ï¶âÏãú Î°úÎìú
    loadYouTubeAPI();
  } else {
    console.log('‚ÑπÔ∏è ÎπÑÎîîÏò§ iframeÏù¥ ÏóÜÏñ¥ÏÑú API Î°úÎìúÌïòÏßÄ ÏïäÏùå');
    // DOM Î≥ÄÍ≤Ω Í∞êÏßÄÎ•º ÏúÑÌïú MutationObserver ÏÑ§Ï†ï
    setupVideoObserver();
  }
  
  isVideoTrackingInitialized = true;
}

// ÎèôÏ†Å ÎπÑÎîîÏò§ iframe Í∞êÏßÄ (ÏÑ§Ï†ï Í∞ÄÎä•)
function detectVideoIframes() {
  const videoPlatformMappings = window.videoPlatformMappings || {
    'youtube': {
      selectors: [
        'iframe[src*="youtube.com"]',
        'iframe[src*="youtu.be"]',
        'iframe[src*="youtube-nocookie.com"]'
      ],
      patterns: ['youtube.com', 'youtu.be', 'youtube-nocookie.com']
    },
    'vimeo': {
      selectors: [
        'iframe[src*="vimeo.com"]',
        'iframe[src*="player.vimeo.com"]'
      ],
      patterns: ['vimeo.com', 'player.vimeo.com']
    },
    'dailymotion': {
      selectors: [
        'iframe[src*="dailymotion.com"]'
      ],
      patterns: ['dailymotion.com']
    },
    'wistia': {
      selectors: [
        'iframe[src*="wistia.com"]',
        'iframe[src*="fast.wistia.com"]'
      ],
      patterns: ['wistia.com', 'fast.wistia.com']
    }
  };
  
  let allIframes = [];
  
  // Î™®Îì† ÌîåÎû´ÌèºÏùò iframe ÏàòÏßë
  for (const [platform, config] of Object.entries(videoPlatformMappings)) {
    const selectors = config.selectors.join(', ');
    const iframes = document.querySelectorAll(selectors);
    iframes.forEach(iframe => {
      iframe.dataset.videoPlatform = platform;
      allIframes.push(iframe);
    });
  }
  
  return allIframes;
}

// DOM Î≥ÄÍ≤Ω Í∞êÏßÄÎ°ú ÎèôÏ†Å ÎπÑÎîîÏò§ iframe Í∞êÏßÄ
function setupVideoObserver() {
  console.log('üîç ÎπÑÎîîÏò§ iframe ÎèôÏ†Å Í∞êÏßÄ ÏÑ§Ï†ï...');
  
  const observer = new MutationObserver(function(mutations) {
    mutations.forEach(function(mutation) {
      mutation.addedNodes.forEach(function(node) {
        if (node.nodeType === 1) { // Element node
          // ÏÉàÎ°ú Ï∂îÍ∞ÄÎêú iframe ÌôïÏù∏
          const videoIframes = detectVideoIframes();
          
          if (videoIframes.length > 0) {
            console.log(`üéØ ÏÉàÎ°úÏö¥ ÎπÑÎîîÏò§ iframe Î∞úÍ≤¨: ${videoIframes.length}Í∞ú`);
            loadYouTubeAPI();
            observer.disconnect(); // Ìïú Î≤à Î∞úÍ≤¨ÌïòÎ©¥ Í¥ÄÏ∞∞ Ï§ëÎã®
          }
        }
      });
    });
  });
  
  observer.observe(document.body, {
    childList: true,
    subtree: true
  });
}

// YouTube API ÎèôÏ†Å Î°úÎìú (Îçî Ï†ïÌôïÌïú Ï∂îÏ†ÅÏùÑ ÏúÑÌï¥)
function loadYouTubeAPI() {
  // Ïù¥ÎØ∏ Î°úÎìúÎêú Í≤ΩÏö∞ Ï§ëÎ≥µ Î°úÎìú Î∞©ÏßÄ
  if (window.YT && window.YT.Player) {
    console.log('‚úÖ YouTube API Ïù¥ÎØ∏ Î°úÎìúÎê®');
    initializeYouTubePlayers();
    return;
  }
  
  // Ïù¥ÎØ∏ Ïä§ÌÅ¨Î¶ΩÌä∏Í∞Ä ÏûàÎäîÏßÄ ÌôïÏù∏
  if (document.querySelector('script[src*="youtube.com/iframe_api"]')) {
    console.log('‚ÑπÔ∏è YouTube API Ïä§ÌÅ¨Î¶ΩÌä∏ Ïù¥ÎØ∏ Ï°¥Ïû¨Ìï®');
    return;
  }
  
  console.log('üé¨ YouTube API Î°úÎìú ÏãúÏûë...');
  const script = document.createElement('script');
  script.src = 'https://www.youtube.com/iframe_api';
  script.async = true;
  script.onload = function() {
    console.log('‚úÖ YouTube API Ïä§ÌÅ¨Î¶ΩÌä∏ Î°úÎìú ÏôÑÎ£å');
  };
  script.onerror = function() {
    console.error('‚ùå YouTube API Ïä§ÌÅ¨Î¶ΩÌä∏ Î°úÎìú Ïã§Ìå®');
  };
  document.head.appendChild(script);
  
  // YouTube API Ï§ÄÎπÑ ÏôÑÎ£å Ïãú Ìò∏Ï∂úÎê† Ìï®Ïàò
  window.onYouTubeIframeAPIReady = function() {
    console.log('‚úÖ YouTube API Ï§ÄÎπÑ ÏôÑÎ£å!');
    initializeYouTubePlayers();
  };
}

// YouTube ÌîåÎ†àÏù¥Ïñ¥ Ï¥àÍ∏∞Ìôî
function initializeYouTubePlayers() {
  const videoIframes = detectVideoIframes();
  console.log(`üéØ ÎπÑÎîîÏò§ iframe Î∞úÍ≤¨: ${videoIframes.length}Í∞ú`);
  
  videoIframes.forEach((iframe, index) => {
    if (!iframe.id) {
      iframe.id = `video_player_${index}`;
    }
    
    // Ï†ëÍ∑ºÏÑ± Í∞úÏÑ†ÏùÑ ÏúÑÌïú iframe ÏÜçÏÑ± ÏÑ§Ï†ï
    iframe.setAttribute('title', 'YouTube video player');
    iframe.setAttribute('aria-label', 'YouTube video player');
    
    console.log(`üé¨ ÎπÑÎîîÏò§ ÌîåÎ†àÏù¥Ïñ¥ Ï¥àÍ∏∞Ìôî: ${iframe.id}`);
    
    try {
      const player = new YT.Player(iframe.id, {
        // Ï†ëÍ∑ºÏÑ± Í∞úÏÑ†ÏùÑ ÏúÑÌïú ÏÑ§Ï†ï
        host: 'https://www.youtube-nocookie.com', // Í∞úÏù∏Ï†ïÎ≥¥ Î≥¥Ìò∏ Í∞ïÌôî
        rel: 0, // Í¥ÄÎ†® ÎèôÏòÅÏÉÅ ÌëúÏãú ÏïàÌï®
        modestbranding: 1, // YouTube Î°úÍ≥† ÏµúÏÜåÌôî
        events: {
          'onReady': function(event) {
            console.log(`‚úÖ ÎπÑÎîîÏò§ ÌîåÎ†àÏù¥Ïñ¥ Ï§ÄÎπÑ ÏôÑÎ£å: ${iframe.id}`);
            
            const videoData = {
              video_name: event.target.getVideoData().title || `ÎπÑÎîîÏò§_${index + 1}`,
              label_name: getVideoLabelName(iframe),
              video_url: `https://www.youtube.com/watch?v=${event.target.getVideoData().video_id}`,
              video_id: iframe.id,
              platform: iframe.dataset.videoPlatform || 'youtube',
              video_duration: Math.round(event.target.getDuration() || 0)
            };
            
            videoSessions.set(iframe.id, {
              ...videoData,
              player: event.target,
              start_time: '',
              pause_count: 0,
              seek_count: 0,
              completion_rate: 0,
              total_watch_time: 0,
              last_position: 0
            });
            
            // ÌîåÎ†àÏù¥Ïñ¥ Ï§ÄÎπÑ ÏôÑÎ£å Ïù¥Î≤§Ìä∏
            trackEvent('te_video_ready', videoData);
          },
          'onStateChange': function(event) {
            const session = videoSessions.get(iframe.id);
            if (!session) {
              console.warn(`‚ö†Ô∏è ÏÑ∏ÏÖòÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏùå: ${iframe.id}`);
              return;
            }
            
            const currentTime = Math.round(session.player.getCurrentTime());
            const duration = Math.round(session.player.getDuration());
            const completionRate = duration > 0 ? Math.round((currentTime / duration) * 100) : 0;
            
            console.log(`üé¨ ÎπÑÎîîÏò§ ÏÉÅÌÉú Î≥ÄÍ≤Ω: ${getYouTubeStateText(event.data)} - ${currentTime}/${duration}Ï¥à (${completionRate}%)`);
            
            // ÏÑ∏ÏÖò ÌôúÎèô ÏóÖÎç∞Ïù¥Ìä∏ (Ï†ÑÏó≠ Ìï®Ïàò ÌôïÏù∏)
            if (typeof window.updateSessionActivity === 'function') {
              window.updateSessionActivity();
            }
            
            switch (event.data) {
              case YT.PlayerState.PLAYING:
                session.start_time = Date.now();
                session.last_position = currentTime;
                
                trackEvent('te_video_play', {
                  video_name: session.video_name,
                  video_url: session.video_url,
                  video_id: session.video_id,
                  video_position: currentTime,
                  video_duration: duration,
                  completion_rate: completionRate,
                  is_replay: currentTime > 5,
                  platform: session.platform
                });
                break;
                
              case YT.PlayerState.PAUSED:
                // ÏãúÏ≤≠ ÏãúÍ∞Ñ Í≥ÑÏÇ∞
                if (session.start_time) {
                  const watchTime = Math.round((Date.now() - session.start_time) / 1000);
                  session.total_watch_time += watchTime;
                }
                
                session.pause_count++;
                session.completion_rate = Math.max(session.completion_rate, completionRate);
                
                trackEvent('te_video_pause', {
                  video_name: session.video_name,
                  video_url: session.video_url,
                  video_id: session.video_id,
                  video_position: currentTime,
                  video_duration: duration,
                  completion_rate: session.completion_rate,
                  pause_count: session.pause_count,
                  total_watch_time: session.total_watch_time,
                  platform: session.platform
                });
                
                // ÏßÑÌñâÎ•† ÎßàÏùºÏä§ÌÜ§ Ï≤¥ÌÅ¨
                checkVideoProgress(session, completionRate);
                break;
                
              case YT.PlayerState.ENDED:
                // ÏãúÏ≤≠ ÏãúÍ∞Ñ Í≥ÑÏÇ∞
                if (session.start_time) {
                  const watchTime = Math.round((Date.now() - session.start_time) / 1000);
                  session.total_watch_time += watchTime;
                }
                
                trackEvent('te_video_ended', {
                  video_name: session.video_name,
                  video_url: session.video_url,
                  video_id: session.video_id,
                  video_position: currentTime,
                  video_duration: duration,
                  completion_rate: 100,
                  total_watch_time: session.total_watch_time,
                  pause_count: session.pause_count,
                  seek_count: session.seek_count,
                  ended_naturally: true,
                  platform: session.platform
                });
                
                // ÏôÑÎ£å Ïù¥Î≤§Ìä∏
                trackEvent('te_video_complete', {
                  video_name: session.video_name,
                  video_url: session.video_url,
                  video_id: session.video_id,
                  video_duration: duration,
                  total_watch_time: session.total_watch_time,
                  pause_count: session.pause_count,
                  seek_count: session.seek_count,
                  completion_rate: 100,
                  platform: session.platform
                });
                break;
                
              case YT.PlayerState.BUFFERING:
                trackEvent('te_video_buffering', {
                  video_name: session.video_name,
                  video_url: session.video_url,
                  video_id: session.video_id,
                  video_position: currentTime,
                  video_duration: duration,
                  platform: session.platform
                });
                break;
                
              case YT.PlayerState.CUED:
                trackEvent('te_video_cued', {
                  video_name: session.video_name,
                  video_url: session.video_url,
                  video_id: session.video_id,
                  platform: session.platform
                });
                break;
            }
          },
          'onError': function(event) {
            console.error('‚ùå ÎπÑÎîîÏò§ ÌîåÎ†àÏù¥Ïñ¥ Ïò§Î•ò:', event.data);
            trackEvent('te_video_error', {
              video_id: iframe.id,
              error_code: event.data,
              platform: iframe.dataset.videoPlatform || 'youtube'
            });
          }
        }
      });
    } catch (error) {
      console.error('‚ùå ÎπÑÎîîÏò§ ÌîåÎ†àÏù¥Ïñ¥ ÏÉùÏÑ± Ïã§Ìå®:', error);
    }
  });
}

// ÎèôÏ†Å ÎπÑÎîîÏò§ ÎùºÎ≤® Ïù¥Î¶Ñ (ÏÑ§Ï†ï Í∞ÄÎä•)
function getVideoLabelName(iframe) {
  const platform = iframe.dataset.videoPlatform || 'youtube';
  
  const labelMappings = window.videoLabelMappings || {
    'youtube': 'YouTube ÎèôÏòÅÏÉÅ ÌîåÎ†àÏù¥Ïñ¥',
    'vimeo': 'Vimeo ÎèôÏòÅÏÉÅ ÌîåÎ†àÏù¥Ïñ¥',
    'dailymotion': 'Dailymotion ÎèôÏòÅÏÉÅ ÌîåÎ†àÏù¥Ïñ¥',
    'wistia': 'Wistia ÎèôÏòÅÏÉÅ ÌîåÎ†àÏù¥Ïñ¥'
  };
  
  return labelMappings[platform] || `${platform} ÎèôÏòÅÏÉÅ ÌîåÎ†àÏù¥Ïñ¥`;
}

// YouTube ÏÉÅÌÉú ÌÖçÏä§Ìä∏ Î≥ÄÌôò
function getYouTubeStateText(state) {
  const states = {
    [-1]: 'UNSTARTED',
    [0]: 'ENDED',
    [1]: 'PLAYING',
    [2]: 'PAUSED',
    [3]: 'BUFFERING',
    [5]: 'CUED'
  };
  return states[state] || `UNKNOWN(${state})`;
}

// ÎπÑÎîîÏò§ ÏßÑÌñâÎ•† ÎßàÏùºÏä§ÌÜ§ Ï≤¥ÌÅ¨ Ìï®Ïàò
function checkVideoProgress(session, currentRate) {
  const milestones = getVideoProgressMilestones();
  
  milestones.forEach(milestone => {
    if (currentRate >= milestone && session.completion_rate < milestone) {
      trackEvent('te_video_progress', {
        video_name: session.video_name,
        video_url: session.video_url,
        video_id: session.video_id,
        completion_rate: milestone,
        milestone_reached: `${milestone}%`,
        total_watch_time: session.total_watch_time,
        platform: session.platform
      });
    }
  });
}

// ÎèôÏ†Å ÎπÑÎîîÏò§ ÏßÑÌñâÎ•† ÎßàÏùºÏä§ÌÜ§ (ÏÑ§Ï†ï Í∞ÄÎä•)
function getVideoProgressMilestones() {
  const defaultMilestones = [25, 50, 75, 90];
  const customMilestones = window.videoProgressMilestones || [];
  return [...defaultMilestones, ...customMilestones].sort((a, b) => a - b);
}

// ÏÑ§Ï†ï ÏóÖÎç∞Ïù¥Ìä∏ Ìï®Ïàò (Îü∞ÌÉÄÏûÑÏóê ÏÑ§Ï†ï Î≥ÄÍ≤Ω Í∞ÄÎä•)
function updateVideoTrackingConfig(newConfig) {
  if (newConfig.videoPlatformMappings) {
    window.videoPlatformMappings = { ...window.videoPlatformMappings, ...newConfig.videoPlatformMappings };
  }
  if (newConfig.videoLabelMappings) {
    window.videoLabelMappings = { ...window.videoLabelMappings, ...newConfig.videoLabelMappings };
  }
  if (newConfig.videoProgressMilestones) {
    window.videoProgressMilestones = [...(window.videoProgressMilestones || []), ...newConfig.videoProgressMilestones];
  }
  
  console.log('üé¨ ÎπÑÎîîÏò§ Ï∂îÏ†Å ÏÑ§Ï†ï ÏóÖÎç∞Ïù¥Ìä∏ ÏôÑÎ£å:', newConfig);
}

// ÎîîÎ≤ÑÍπÖÏö© Ìï®Ïàò
function debugVideoTracking() {
  console.log('üé¨ ÎπÑÎîîÏò§ Ï∂îÏ†Å ÎîîÎ≤ÑÍπÖ Ï†ïÎ≥¥:');
  console.log('- ÎπÑÎîîÏò§ ÌîåÎû´Ìèº Îß§Ìïë:', window.videoPlatformMappings);
  console.log('- ÎπÑÎîîÏò§ ÎùºÎ≤® Îß§Ìïë:', window.videoLabelMappings);
  console.log('- ÎπÑÎîîÏò§ ÏßÑÌñâÎ•† ÎßàÏùºÏä§ÌÜ§:', getVideoProgressMilestones());
  console.log('- ÌòÑÏû¨ ÎπÑÎîîÏò§ ÏÑ∏ÏÖò Ïàò:', videoSessions.size);
  console.log('- ThinkingData SDK:', typeof window.te !== 'undefined' ? 'Î°úÎìúÎê®' : 'Î°úÎìú ÏïàÎê®');
  console.log('- YouTube API:', typeof window.YT !== 'undefined' ? 'Î°úÎìúÎê®' : 'Î°úÎìú ÏïàÎê®');
  console.log('- ÎπÑÎîîÏò§ Ï∂îÏ†Å Ï¥àÍ∏∞Ìôî:', isVideoTrackingInitialized);
  
  // ÌòÑÏû¨ ÌéòÏù¥ÏßÄÏùò ÎπÑÎîîÏò§ ÏöîÏÜåÎì§ ÌôïÏù∏
  const videoIframes = detectVideoIframes();
  console.log('- ÌòÑÏû¨ ÌéòÏù¥ÏßÄ ÎπÑÎîîÏò§ iframe Í∞úÏàò:', videoIframes.length);
  
  videoIframes.forEach((iframe, index) => {
    console.log(`  - iframe ${index + 1}:`, {
      id: iframe.id,
      src: iframe.src,
      platform: iframe.dataset.videoPlatform,
      label: getVideoLabelName(iframe)
    });
  });
  
  // ÏàòÎèôÏúºÎ°ú ÎπÑÎîîÏò§ Ï∂îÏ†Å Ïã§Ìñâ
  console.log('üé¨ ÏàòÎèôÏúºÎ°ú ÎπÑÎîîÏò§ Ï∂îÏ†Å Ïã§Ìñâ...');
  trackVideoEvents();
}

// Ï†ÑÏó≠ Ìï®ÏàòÎ°ú ÎÖ∏Ï∂ú
window.trackVideoEvents = trackVideoEvents;
window.updateVideoTrackingConfig = updateVideoTrackingConfig;
window.debugVideoTracking = debugVideoTracking;
window.videoSessions = videoSessions;
window.isVideoTrackingInitialized = isVideoTrackingInitialized;

// ÏÑ∏ÏÖò ÌôúÎèô ÏóÖÎç∞Ïù¥Ìä∏ Ìï®Ïàò
window.updateSessionActivity = function() {
  // ÏÑ∏ÏÖò ÌôúÎèô ÏóÖÎç∞Ïù¥Ìä∏ Ìï®ÏàòÍ∞Ä ÏûàÏúºÎ©¥ Ìò∏Ï∂ú
  if (typeof window.updateSessionActivity === 'function') {
    window.updateSessionActivity();
  }
};

// ÏàòÎèô ÎπÑÎîîÏò§ Ï∂îÏ†Å Ïã§Ìñâ Ìï®Ïàò
window.forceVideoTracking = function() {
  console.log('üé¨ Í∞ïÏ†ú ÎπÑÎîîÏò§ Ï∂îÏ†Å Ïã§Ìñâ...');
  isVideoTrackingInitialized = false; // Ï¥àÍ∏∞Ìôî ÌîåÎûòÍ∑∏ Î¶¨ÏÖã
  trackVideoEvents();
};

// DOM Î°úÎìú ÏôÑÎ£å ÌõÑ ÏûêÎèô Ïã§Ìñâ
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', function() {
    console.log('üé¨ DOM Î°úÎìú ÏôÑÎ£å, ÎπÑÎîîÏò§ Ï∂îÏ†Å ÏãúÏûë');
    setTimeout(trackVideoEvents, 1000); // 1Ï¥à ÏßÄÏó∞ÏúºÎ°ú ÏïàÏ†ïÏÑ± ÌôïÎ≥¥
  });
} else {
  // DOMÏù¥ Ïù¥ÎØ∏ Î°úÎìúÎêú Í≤ΩÏö∞
  console.log('üé¨ DOM Ïù¥ÎØ∏ Î°úÎìúÎê®, ÎπÑÎîîÏò§ Ï∂îÏ†Å ÏãúÏûë');
  setTimeout(trackVideoEvents, 1000);
}

// Ï∂îÍ∞Ä: ÌéòÏù¥ÏßÄ Î°úÎìú ÏôÑÎ£å ÌõÑ Ìïú Î≤à Îçî ÏãúÎèÑ
window.addEventListener('load', function() {
  console.log('üé¨ ÌéòÏù¥ÏßÄ Î°úÎìú ÏôÑÎ£å, ÎπÑÎîîÏò§ Ï∂îÏ†Å Ïû¨ÌôïÏù∏');
  setTimeout(trackVideoEvents, 2000);
});

// Ï∂îÍ∞Ä: 3Ï¥à ÌõÑ Ìïú Î≤à Îçî ÏãúÎèÑ
setTimeout(function() {
  console.log('üé¨ 3Ï¥à ÌõÑ ÎπÑÎîîÏò§ Ï∂îÏ†Å Ïû¨ÌôïÏù∏');
  trackVideoEvents();
}, 3000);

// Ï∂îÍ∞Ä: 5Ï¥à ÌõÑ Ìïú Î≤à Îçî ÏãúÎèÑ (ÎèôÏ†Å ÏΩòÌÖêÏ∏† ÎåÄÏùë)
setTimeout(function() {
  console.log('üé¨ 5Ï¥à ÌõÑ ÎπÑÎîîÏò§ Ï∂îÏ†Å Ïû¨ÌôïÏù∏');
  trackVideoEvents();
}, 5000);

// Ï∂îÍ∞Ä: 10Ï¥à ÌõÑ Ìïú Î≤à Îçî ÏãúÎèÑ (ÏµúÏ¢Ö ÏãúÎèÑ)
setTimeout(function() {
  console.log('üé¨ 10Ï¥à ÌõÑ ÎπÑÎîîÏò§ Ï∂îÏ†Å ÏµúÏ¢Ö ÏãúÎèÑ');
  trackVideoEvents();
}, 10000);

// ThinkingData Ï¥àÍ∏∞Ìôî ÏôÑÎ£å Ïù¥Î≤§Ìä∏ Í∞êÏßÄ
window.addEventListener('thinkingdata:ready', function() {
  console.log('üé¨ ThinkingData Ï¥àÍ∏∞Ìôî ÏôÑÎ£å, ÎπÑÎîîÏò§ Ï∂îÏ†Å ÏãúÏûë');
  setTimeout(trackVideoEvents, 500);
});

// ÌéòÏù¥ÏßÄ Î°úÎìú ÏôÑÎ£å ÌõÑ Ìïú Î≤à Îçî ÏãúÎèÑ (ÎèôÏ†Å ÏΩòÌÖêÏ∏† ÎåÄÏùë)
window.addEventListener('load', function() {
  console.log('üé¨ ÌéòÏù¥ÏßÄ Î°úÎìú ÏôÑÎ£å, ÎπÑÎîîÏò§ Ï∂îÏ†Å Ïû¨ÌôïÏù∏');
  setTimeout(trackVideoEvents, 2000);
});