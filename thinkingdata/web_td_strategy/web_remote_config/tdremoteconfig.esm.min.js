function asyncGeneratorStep(n,t,e,r,o,a,c){try{var i=n[a](c),u=i.value}catch(n){return void e(n)}i.done?t(u):Promise.resolve(u).then(r,o)}function _asyncToGenerator(n){return function(){var t=this,e=arguments;return new Promise((function(r,o){var a=n.apply(t,e);function _next(n){asyncGeneratorStep(a,r,o,_next,_throw,"next",n)}function _throw(n){asyncGeneratorStep(a,r,o,_next,_throw,"throw",n)}_next(void 0)}))}}function _classCallCheck(a,n){if(!(a instanceof n))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,r){for(var t=0;t<r.length;t++){var o=r[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,_toPropertyKey(o.key),o)}}function _createClass(e,r,t){return r&&_defineProperties(e.prototype,r),t&&_defineProperties(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function _regenerator(){
/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */
var e,t,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function i(r,n,o,i){var c=n&&n.prototype instanceof Generator?n:Generator,u=Object.create(c.prototype);return _regeneratorDefine(u,"_invoke",function(r,n,o){var i,c,u,f=0,p=o||[],y=!1,G={p:0,n:0,v:e,a:d,f:d.bind(e,4),d:function(t,r){return i=t,c=0,u=e,G.n=r,a}};function d(r,n){for(c=r,u=n,t=0;!y&&f&&!o&&t<p.length;t++){var o,i=p[t],d=G.p,l=i[2];r>3?(o=l===n)&&(u=i[(c=i[4])?5:(c=3,3)],i[4]=i[5]=e):i[0]<=d&&((o=r<2&&d<i[1])?(c=0,G.v=n,G.n=i[1]):d<l&&(o=r<3||i[0]>n||n>l)&&(i[4]=r,i[5]=n,G.n=l,c=0))}if(o||r>1)return a;throw y=!0,n}return function(o,p,l){if(f>1)throw TypeError("Generator is already running");for(y&&1===p&&d(p,l),c=p,u=l;(t=c<2?e:u)||!y;){i||(c?c<3?(c>1&&(G.n=-1),d(c,u)):G.n=u:G.v=u);try{if(f=2,i){if(c||(o="next"),t=i[o]){if(!(t=t.call(i,u)))throw TypeError("iterator result is not an object");if(!t.done)return t;u=t.value,c<2&&(c=0)}else 1===c&&(t=i.return)&&t.call(i),c<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),c=1);i=e}else if((t=(y=G.n<0)?u:r.call(n,G))!==a)break}catch(t){i=e,c=1,u=t}finally{f=1}}return{value:t,done:y}}}(r,o,i),!0),u}var a={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}t=Object.getPrototypeOf;var c=[][n]?t(t([][n]())):(_regeneratorDefine(t={},n,(function(){return this})),t),u=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(c);function f(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,GeneratorFunctionPrototype):(e.__proto__=GeneratorFunctionPrototype,_regeneratorDefine(e,o,"GeneratorFunction")),e.prototype=Object.create(u),e}return GeneratorFunction.prototype=GeneratorFunctionPrototype,_regeneratorDefine(u,"constructor",GeneratorFunctionPrototype),_regeneratorDefine(GeneratorFunctionPrototype,"constructor",GeneratorFunction),GeneratorFunction.displayName="GeneratorFunction",_regeneratorDefine(GeneratorFunctionPrototype,o,"GeneratorFunction"),_regeneratorDefine(u),_regeneratorDefine(u,o,"Generator"),_regeneratorDefine(u,n,(function(){return this})),_regeneratorDefine(u,"toString",(function(){return"[object Generator]"})),(_regenerator=function(){return{w:i,m:f}})()}function _regeneratorDefine(e,r,n,t){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}_regeneratorDefine=function(e,r,n,t){if(r)i?i(e,r,{value:n,enumerable:!t,configurable:!t,writable:!t}):e[r]=n;else{function o(r,n){_regeneratorDefine(e,r,(function(e){return this._invoke(r,n,e)}))}o("next",0),o("throw",1),o("return",2)}},_regeneratorDefine(e,r,n,t)}function _toPrimitive(t,r){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}function _toPropertyKey(t){var i=_toPrimitive(t,"string");return"symbol"==typeof i?i:i+""}function _typeof(o){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},_typeof(o)}var Config={LIB_VERSION:"1.1.1",TEMPLATE_DEFAULT:"default",USER_ID_EXPIRED_TIME:2592e3,CONFIG_EXPIRED_TIME:43200,ACTIVATION_STRATEGY_IMMEDIATELY:"immediately",ACTIVATION_STRATEGY_NEXT:"next",DATE_TYPE:"datetime",NETWORK_TIMEOUT:-10002,SIGN_ILLEGAL:-10004};var chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";var lookup=typeof Uint8Array==="undefined"?[]:new Uint8Array(256);for(var i=0;i<chars.length;i++){lookup[chars.charCodeAt(i)]=i}var encode=function encode(arraybuffer){var bytes=new Uint8Array(arraybuffer),i,len=bytes.length,base64="";for(i=0;i<len;i+=3){base64+=chars[bytes[i]>>2];base64+=chars[(bytes[i]&3)<<4|bytes[i+1]>>4];base64+=chars[(bytes[i+1]&15)<<2|bytes[i+2]>>6];base64+=chars[bytes[i+2]&63]}if(len%3===2){base64=base64.substring(0,base64.length-1)+"="}else if(len%3===1){base64=base64.substring(0,base64.length-2)+"=="}return base64};var decode=function decode(base64){var bufferLength=base64.length*.75,len=base64.length,i,p=0,encoded1,encoded2,encoded3,encoded4;if(base64[base64.length-1]==="="){bufferLength--;if(base64[base64.length-2]==="="){bufferLength--}}var arraybuffer=new ArrayBuffer(bufferLength),bytes=new Uint8Array(arraybuffer);for(i=0;i<len;i+=4){encoded1=lookup[base64.charCodeAt(i)];encoded2=lookup[base64.charCodeAt(i+1)];encoded3=lookup[base64.charCodeAt(i+2)];encoded4=lookup[base64.charCodeAt(i+3)];bytes[p++]=encoded1<<2|encoded2>>4;bytes[p++]=(encoded2&15)<<4|encoded3>>2;bytes[p++]=(encoded3&3)<<6|encoded4&63}return arraybuffer};function zero$1(buf){var len=buf.length;while(--len>=0){buf[len]=0}}var MIN_MATCH$1=3;var MAX_MATCH$1=258;var LENGTH_CODES$1=29;var LITERALS$1=256;var L_CODES$1=LITERALS$1+1+LENGTH_CODES$1;var D_CODES$1=30;var DIST_CODE_LEN=512;var static_ltree=new Array((L_CODES$1+2)*2);zero$1(static_ltree);var static_dtree=new Array(D_CODES$1*2);zero$1(static_dtree);var _dist_code=new Array(DIST_CODE_LEN);zero$1(_dist_code);var _length_code=new Array(MAX_MATCH$1-MIN_MATCH$1+1);zero$1(_length_code);var base_length=new Array(LENGTH_CODES$1);zero$1(base_length);var base_dist=new Array(D_CODES$1);zero$1(base_dist);var adler32=function adler32(adler,buf,len,pos){var s1=adler&65535|0,s2=adler>>>16&65535|0,n=0;while(len!==0){n=len>2e3?2e3:len;len-=n;do{s1=s1+buf[pos++]|0;s2=s2+s1|0}while(--n);s1%=65521;s2%=65521}return s1|s2<<16|0};var adler32_1=adler32;var makeTable=function makeTable(){var c,table=[];for(var n=0;n<256;n++){c=n;for(var k=0;k<8;k++){c=c&1?3988292384^c>>>1:c>>>1}table[n]=c}return table};var crcTable=new Uint32Array(makeTable());var crc32=function crc32(crc,buf,len,pos){var t=crcTable;var end=pos+len;crc^=-1;for(var i=pos;i<end;i++){crc=crc>>>8^t[(crc^buf[i])&255]}return crc^-1};var crc32_1=crc32;var messages={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"};var constants$2={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};var _has=function _has(obj,key){return Object.prototype.hasOwnProperty.call(obj,key)};var assign=function assign(obj){var sources=Array.prototype.slice.call(arguments,1);while(sources.length){var source=sources.shift();if(!source){continue}if(_typeof(source)!=="object"){throw new TypeError(source+"must be non-object")}for(var p in source){if(_has(source,p)){obj[p]=source[p]}}}return obj};var flattenChunks=function flattenChunks(chunks){var len=0;for(var i=0,l=chunks.length;i<l;i++){len+=chunks[i].length}var result=new Uint8Array(len);for(var _i=0,pos=0,_l=chunks.length;_i<_l;_i++){var chunk=chunks[_i];result.set(chunk,pos);pos+=chunk.length}return result};var common={assign:assign,flattenChunks:flattenChunks};var STR_APPLY_UIA_OK=true;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(__){STR_APPLY_UIA_OK=false}var _utf8len=new Uint8Array(256);for(var q=0;q<256;q++){_utf8len[q]=q>=252?6:q>=248?5:q>=240?4:q>=224?3:q>=192?2:1}_utf8len[254]=_utf8len[254]=1;var string2buf=function string2buf(str){if(typeof TextEncoder==="function"&&TextEncoder.prototype.encode){return(new TextEncoder).encode(str)}var buf,c,c2,m_pos,i,str_len=str.length,buf_len=0;for(m_pos=0;m_pos<str_len;m_pos++){c=str.charCodeAt(m_pos);if((c&64512)===55296&&m_pos+1<str_len){c2=str.charCodeAt(m_pos+1);if((c2&64512)===56320){c=65536+(c-55296<<10)+(c2-56320);m_pos++}}buf_len+=c<128?1:c<2048?2:c<65536?3:4}buf=new Uint8Array(buf_len);for(i=0,m_pos=0;i<buf_len;m_pos++){c=str.charCodeAt(m_pos);if((c&64512)===55296&&m_pos+1<str_len){c2=str.charCodeAt(m_pos+1);if((c2&64512)===56320){c=65536+(c-55296<<10)+(c2-56320);m_pos++}}if(c<128){buf[i++]=c}else if(c<2048){buf[i++]=192|c>>>6;buf[i++]=128|c&63}else if(c<65536){buf[i++]=224|c>>>12;buf[i++]=128|c>>>6&63;buf[i++]=128|c&63}else{buf[i++]=240|c>>>18;buf[i++]=128|c>>>12&63;buf[i++]=128|c>>>6&63;buf[i++]=128|c&63}}return buf};var buf2binstring=function buf2binstring(buf,len){if(len<65534){if(buf.subarray&&STR_APPLY_UIA_OK){return String.fromCharCode.apply(null,buf.length===len?buf:buf.subarray(0,len))}}var result="";for(var i=0;i<len;i++){result+=String.fromCharCode(buf[i])}return result};var buf2string=function buf2string(buf,max){var len=max||buf.length;if(typeof TextDecoder==="function"&&TextDecoder.prototype.decode){return(new TextDecoder).decode(buf.subarray(0,max))}var i,out;var utf16buf=new Array(len*2);for(out=0,i=0;i<len;){var c=buf[i++];if(c<128){utf16buf[out++]=c;continue}var c_len=_utf8len[c];if(c_len>4){utf16buf[out++]=65533;i+=c_len-1;continue}c&=c_len===2?31:c_len===3?15:7;while(c_len>1&&i<len){c=c<<6|buf[i++]&63;c_len--}if(c_len>1){utf16buf[out++]=65533;continue}if(c<65536){utf16buf[out++]=c}else{c-=65536;utf16buf[out++]=55296|c>>10&1023;utf16buf[out++]=56320|c&1023}}return buf2binstring(utf16buf,out)};var utf8border=function utf8border(buf,max){max=max||buf.length;if(max>buf.length){max=buf.length}var pos=max-1;while(pos>=0&&(buf[pos]&192)===128){pos--}if(pos<0){return max}if(pos===0){return max}return pos+_utf8len[buf[pos]]>max?pos:max};var strings={string2buf:string2buf,buf2string:buf2string,utf8border:utf8border};function ZStream(){this.input=null;this.next_in=0;this.avail_in=0;this.total_in=0;this.output=null;this.next_out=0;this.avail_out=0;this.total_out=0;this.msg="";this.state=null;this.data_type=2;this.adler=0}var zstream=ZStream;var BAD$1=16209;var TYPE$1=16191;var inffast=function inflate_fast(strm,start){var _in;var last;var _out;var beg;var end;var dmax;var wsize;var whave;var wnext;var s_window;var hold;var bits;var lcode;var dcode;var lmask;var dmask;var here;var op;var len;var dist;var from;var from_source;var input,output;var state=strm.state;_in=strm.next_in;input=strm.input;last=_in+(strm.avail_in-5);_out=strm.next_out;output=strm.output;beg=_out-(start-strm.avail_out);end=_out+(strm.avail_out-257);dmax=state.dmax;wsize=state.wsize;whave=state.whave;wnext=state.wnext;s_window=state.window;hold=state.hold;bits=state.bits;lcode=state.lencode;dcode=state.distcode;lmask=(1<<state.lenbits)-1;dmask=(1<<state.distbits)-1;top:do{if(bits<15){hold+=input[_in++]<<bits;bits+=8;hold+=input[_in++]<<bits;bits+=8}here=lcode[hold&lmask];dolen:for(;;){op=here>>>24;hold>>>=op;bits-=op;op=here>>>16&255;if(op===0){output[_out++]=here&65535}else if(op&16){len=here&65535;op&=15;if(op){if(bits<op){hold+=input[_in++]<<bits;bits+=8}len+=hold&(1<<op)-1;hold>>>=op;bits-=op}if(bits<15){hold+=input[_in++]<<bits;bits+=8;hold+=input[_in++]<<bits;bits+=8}here=dcode[hold&dmask];dodist:for(;;){op=here>>>24;hold>>>=op;bits-=op;op=here>>>16&255;if(op&16){dist=here&65535;op&=15;if(bits<op){hold+=input[_in++]<<bits;bits+=8;if(bits<op){hold+=input[_in++]<<bits;bits+=8}}dist+=hold&(1<<op)-1;if(dist>dmax){strm.msg="invalid distance too far back";state.mode=BAD$1;break top}hold>>>=op;bits-=op;op=_out-beg;if(dist>op){op=dist-op;if(op>whave){if(state.sane){strm.msg="invalid distance too far back";state.mode=BAD$1;break top}}from=0;from_source=s_window;if(wnext===0){from+=wsize-op;if(op<len){len-=op;do{output[_out++]=s_window[from++]}while(--op);from=_out-dist;from_source=output}}else if(wnext<op){from+=wsize+wnext-op;op-=wnext;if(op<len){len-=op;do{output[_out++]=s_window[from++]}while(--op);from=0;if(wnext<len){op=wnext;len-=op;do{output[_out++]=s_window[from++]}while(--op);from=_out-dist;from_source=output}}}else{from+=wnext-op;if(op<len){len-=op;do{output[_out++]=s_window[from++]}while(--op);from=_out-dist;from_source=output}}while(len>2){output[_out++]=from_source[from++];output[_out++]=from_source[from++];output[_out++]=from_source[from++];len-=3}if(len){output[_out++]=from_source[from++];if(len>1){output[_out++]=from_source[from++]}}}else{from=_out-dist;do{output[_out++]=output[from++];output[_out++]=output[from++];output[_out++]=output[from++];len-=3}while(len>2);if(len){output[_out++]=output[from++];if(len>1){output[_out++]=output[from++]}}}}else if((op&64)===0){here=dcode[(here&65535)+(hold&(1<<op)-1)];continue dodist}else{strm.msg="invalid distance code";state.mode=BAD$1;break top}break}}else if((op&64)===0){here=lcode[(here&65535)+(hold&(1<<op)-1)];continue dolen}else if(op&32){state.mode=TYPE$1;break top}else{strm.msg="invalid literal/length code";state.mode=BAD$1;break top}break}}while(_in<last&&_out<end);len=bits>>3;_in-=len;bits-=len<<3;hold&=(1<<bits)-1;strm.next_in=_in;strm.next_out=_out;strm.avail_in=_in<last?5+(last-_in):5-(_in-last);strm.avail_out=_out<end?257+(end-_out):257-(_out-end);state.hold=hold;state.bits=bits;return};var MAXBITS=15;var ENOUGH_LENS$1=852;var ENOUGH_DISTS$1=592;var CODES$1=0;var LENS$1=1;var DISTS$1=2;var lbase=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]);var lext=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]);var dbase=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]);var dext=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var inflate_table=function inflate_table(type,lens,lens_index,codes,table,table_index,work,opts){var bits=opts.bits;var len=0;var sym=0;var min=0,max=0;var root=0;var curr=0;var drop=0;var left=0;var used=0;var huff=0;var incr;var fill;var low;var mask;var next;var base=null;var match;var count=new Uint16Array(MAXBITS+1);var offs=new Uint16Array(MAXBITS+1);var extra=null;var here_bits,here_op,here_val;for(len=0;len<=MAXBITS;len++){count[len]=0}for(sym=0;sym<codes;sym++){count[lens[lens_index+sym]]++}root=bits;for(max=MAXBITS;max>=1;max--){if(count[max]!==0){break}}if(root>max){root=max}if(max===0){table[table_index++]=1<<24|64<<16|0;table[table_index++]=1<<24|64<<16|0;opts.bits=1;return 0}for(min=1;min<max;min++){if(count[min]!==0){break}}if(root<min){root=min}left=1;for(len=1;len<=MAXBITS;len++){left<<=1;left-=count[len];if(left<0){return-1}}if(left>0&&(type===CODES$1||max!==1)){return-1}offs[1]=0;for(len=1;len<MAXBITS;len++){offs[len+1]=offs[len]+count[len]}for(sym=0;sym<codes;sym++){if(lens[lens_index+sym]!==0){work[offs[lens[lens_index+sym]]++]=sym}}if(type===CODES$1){base=extra=work;match=20}else if(type===LENS$1){base=lbase;extra=lext;match=257}else{base=dbase;extra=dext;match=0}huff=0;sym=0;len=min;next=table_index;curr=root;drop=0;low=-1;used=1<<root;mask=used-1;if(type===LENS$1&&used>ENOUGH_LENS$1||type===DISTS$1&&used>ENOUGH_DISTS$1){return 1}for(;;){here_bits=len-drop;if(work[sym]+1<match){here_op=0;here_val=work[sym]}else if(work[sym]>=match){here_op=extra[work[sym]-match];here_val=base[work[sym]-match]}else{here_op=32+64;here_val=0}incr=1<<len-drop;fill=1<<curr;min=fill;do{fill-=incr;table[next+(huff>>drop)+fill]=here_bits<<24|here_op<<16|here_val|0}while(fill!==0);incr=1<<len-1;while(huff&incr){incr>>=1}if(incr!==0){huff&=incr-1;huff+=incr}else{huff=0}sym++;if(--count[len]===0){if(len===max){break}len=lens[lens_index+work[sym]]}if(len>root&&(huff&mask)!==low){if(drop===0){drop=root}next+=min;curr=len-drop;left=1<<curr;while(curr+drop<max){left-=count[curr+drop];if(left<=0){break}curr++;left<<=1}used+=1<<curr;if(type===LENS$1&&used>ENOUGH_LENS$1||type===DISTS$1&&used>ENOUGH_DISTS$1){return 1}low=huff&mask;table[low]=root<<24|curr<<16|next-table_index|0}}if(huff!==0){table[next+huff]=len-drop<<24|64<<16|0}opts.bits=root;return 0};var inftrees=inflate_table;var CODES=0;var LENS=1;var DISTS=2;var Z_FINISH$1=constants$2.Z_FINISH,Z_BLOCK=constants$2.Z_BLOCK,Z_TREES=constants$2.Z_TREES,Z_OK$1=constants$2.Z_OK,Z_STREAM_END$1=constants$2.Z_STREAM_END,Z_NEED_DICT$1=constants$2.Z_NEED_DICT,Z_STREAM_ERROR$1=constants$2.Z_STREAM_ERROR,Z_DATA_ERROR$1=constants$2.Z_DATA_ERROR,Z_MEM_ERROR$1=constants$2.Z_MEM_ERROR,Z_BUF_ERROR=constants$2.Z_BUF_ERROR,Z_DEFLATED=constants$2.Z_DEFLATED;var HEAD=16180;var FLAGS=16181;var TIME=16182;var OS=16183;var EXLEN=16184;var EXTRA=16185;var NAME=16186;var COMMENT=16187;var HCRC=16188;var DICTID=16189;var DICT=16190;var TYPE=16191;var TYPEDO=16192;var STORED=16193;var COPY_=16194;var COPY=16195;var TABLE=16196;var LENLENS=16197;var CODELENS=16198;var LEN_=16199;var LEN=16200;var LENEXT=16201;var DIST=16202;var DISTEXT=16203;var MATCH=16204;var LIT=16205;var CHECK=16206;var LENGTH=16207;var DONE=16208;var BAD=16209;var MEM=16210;var SYNC=16211;var ENOUGH_LENS=852;var ENOUGH_DISTS=592;var MAX_WBITS=15;var DEF_WBITS=MAX_WBITS;var zswap32=function zswap32(q){return(q>>>24&255)+(q>>>8&65280)+((q&65280)<<8)+((q&255)<<24)};function InflateState(){this.strm=null;this.mode=0;this.last=false;this.wrap=0;this.havedict=false;this.flags=0;this.dmax=0;this.check=0;this.total=0;this.head=null;this.wbits=0;this.wsize=0;this.whave=0;this.wnext=0;this.window=null;this.hold=0;this.bits=0;this.length=0;this.offset=0;this.extra=0;this.lencode=null;this.distcode=null;this.lenbits=0;this.distbits=0;this.ncode=0;this.nlen=0;this.ndist=0;this.have=0;this.next=null;this.lens=new Uint16Array(320);this.work=new Uint16Array(288);this.lendyn=null;this.distdyn=null;this.sane=0;this.back=0;this.was=0}var inflateStateCheck=function inflateStateCheck(strm){if(!strm){return 1}var state=strm.state;if(!state||state.strm!==strm||state.mode<HEAD||state.mode>SYNC){return 1}return 0};var inflateResetKeep=function inflateResetKeep(strm){if(inflateStateCheck(strm)){return Z_STREAM_ERROR$1}var state=strm.state;strm.total_in=strm.total_out=state.total=0;strm.msg="";if(state.wrap){strm.adler=state.wrap&1}state.mode=HEAD;state.last=0;state.havedict=0;state.flags=-1;state.dmax=32768;state.head=null;state.hold=0;state.bits=0;state.lencode=state.lendyn=new Int32Array(ENOUGH_LENS);state.distcode=state.distdyn=new Int32Array(ENOUGH_DISTS);state.sane=1;state.back=-1;return Z_OK$1};var inflateReset=function inflateReset(strm){if(inflateStateCheck(strm)){return Z_STREAM_ERROR$1}var state=strm.state;state.wsize=0;state.whave=0;state.wnext=0;return inflateResetKeep(strm)};var inflateReset2=function inflateReset2(strm,windowBits){var wrap;if(inflateStateCheck(strm)){return Z_STREAM_ERROR$1}var state=strm.state;if(windowBits<0){wrap=0;windowBits=-windowBits}else{wrap=(windowBits>>4)+5;if(windowBits<48){windowBits&=15}}if(windowBits&&(windowBits<8||windowBits>15)){return Z_STREAM_ERROR$1}if(state.window!==null&&state.wbits!==windowBits){state.window=null}state.wrap=wrap;state.wbits=windowBits;return inflateReset(strm)};var inflateInit2=function inflateInit2(strm,windowBits){if(!strm){return Z_STREAM_ERROR$1}var state=new InflateState;strm.state=state;state.strm=strm;state.window=null;state.mode=HEAD;var ret=inflateReset2(strm,windowBits);if(ret!==Z_OK$1){strm.state=null}return ret};var inflateInit=function inflateInit(strm){return inflateInit2(strm,DEF_WBITS)};var virgin=true;var lenfix,distfix;var fixedtables=function fixedtables(state){if(virgin){lenfix=new Int32Array(512);distfix=new Int32Array(32);var sym=0;while(sym<144){state.lens[sym++]=8}while(sym<256){state.lens[sym++]=9}while(sym<280){state.lens[sym++]=7}while(sym<288){state.lens[sym++]=8}inftrees(LENS,state.lens,0,288,lenfix,0,state.work,{bits:9});sym=0;while(sym<32){state.lens[sym++]=5}inftrees(DISTS,state.lens,0,32,distfix,0,state.work,{bits:5});virgin=false}state.lencode=lenfix;state.lenbits=9;state.distcode=distfix;state.distbits=5};var updatewindow=function updatewindow(strm,src,end,copy){var dist;var state=strm.state;if(state.window===null){state.wsize=1<<state.wbits;state.wnext=0;state.whave=0;state.window=new Uint8Array(state.wsize)}if(copy>=state.wsize){state.window.set(src.subarray(end-state.wsize,end),0);state.wnext=0;state.whave=state.wsize}else{dist=state.wsize-state.wnext;if(dist>copy){dist=copy}state.window.set(src.subarray(end-copy,end-copy+dist),state.wnext);copy-=dist;if(copy){state.window.set(src.subarray(end-copy,end),0);state.wnext=copy;state.whave=state.wsize}else{state.wnext+=dist;if(state.wnext===state.wsize){state.wnext=0}if(state.whave<state.wsize){state.whave+=dist}}}return 0};var inflate$2=function inflate$2(strm,flush){var state;var input,output;var next;var put;var have,left;var hold;var bits;var _in,_out;var copy;var from;var from_source;var here=0;var here_bits,here_op,here_val;var last_bits,last_op,last_val;var len;var ret;var hbuf=new Uint8Array(4);var opts;var n;var order=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(inflateStateCheck(strm)||!strm.output||!strm.input&&strm.avail_in!==0){return Z_STREAM_ERROR$1}state=strm.state;if(state.mode===TYPE){state.mode=TYPEDO}put=strm.next_out;output=strm.output;left=strm.avail_out;next=strm.next_in;input=strm.input;have=strm.avail_in;hold=state.hold;bits=state.bits;_in=have;_out=left;ret=Z_OK$1;inf_leave:for(;;){switch(state.mode){case HEAD:if(state.wrap===0){state.mode=TYPEDO;break}while(bits<16){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}if(state.wrap&2&&hold===35615){if(state.wbits===0){state.wbits=15}state.check=0;hbuf[0]=hold&255;hbuf[1]=hold>>>8&255;state.check=crc32_1(state.check,hbuf,2,0);hold=0;bits=0;state.mode=FLAGS;break}if(state.head){state.head.done=false}if(!(state.wrap&1)||(((hold&255)<<8)+(hold>>8))%31){strm.msg="incorrect header check";state.mode=BAD;break}if((hold&15)!==Z_DEFLATED){strm.msg="unknown compression method";state.mode=BAD;break}hold>>>=4;bits-=4;len=(hold&15)+8;if(state.wbits===0){state.wbits=len}if(len>15||len>state.wbits){strm.msg="invalid window size";state.mode=BAD;break}state.dmax=1<<state.wbits;state.flags=0;strm.adler=state.check=1;state.mode=hold&512?DICTID:TYPE;hold=0;bits=0;break;case FLAGS:while(bits<16){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}state.flags=hold;if((state.flags&255)!==Z_DEFLATED){strm.msg="unknown compression method";state.mode=BAD;break}if(state.flags&57344){strm.msg="unknown header flags set";state.mode=BAD;break}if(state.head){state.head.text=hold>>8&1}if(state.flags&512&&state.wrap&4){hbuf[0]=hold&255;hbuf[1]=hold>>>8&255;state.check=crc32_1(state.check,hbuf,2,0)}hold=0;bits=0;state.mode=TIME;case TIME:while(bits<32){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}if(state.head){state.head.time=hold}if(state.flags&512&&state.wrap&4){hbuf[0]=hold&255;hbuf[1]=hold>>>8&255;hbuf[2]=hold>>>16&255;hbuf[3]=hold>>>24&255;state.check=crc32_1(state.check,hbuf,4,0)}hold=0;bits=0;state.mode=OS;case OS:while(bits<16){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}if(state.head){state.head.xflags=hold&255;state.head.os=hold>>8}if(state.flags&512&&state.wrap&4){hbuf[0]=hold&255;hbuf[1]=hold>>>8&255;state.check=crc32_1(state.check,hbuf,2,0)}hold=0;bits=0;state.mode=EXLEN;case EXLEN:if(state.flags&1024){while(bits<16){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}state.length=hold;if(state.head){state.head.extra_len=hold}if(state.flags&512&&state.wrap&4){hbuf[0]=hold&255;hbuf[1]=hold>>>8&255;state.check=crc32_1(state.check,hbuf,2,0)}hold=0;bits=0}else if(state.head){state.head.extra=null}state.mode=EXTRA;case EXTRA:if(state.flags&1024){copy=state.length;if(copy>have){copy=have}if(copy){if(state.head){len=state.head.extra_len-state.length;if(!state.head.extra){state.head.extra=new Uint8Array(state.head.extra_len)}state.head.extra.set(input.subarray(next,next+copy),len)}if(state.flags&512&&state.wrap&4){state.check=crc32_1(state.check,input,copy,next)}have-=copy;next+=copy;state.length-=copy}if(state.length){break inf_leave}}state.length=0;state.mode=NAME;case NAME:if(state.flags&2048){if(have===0){break inf_leave}copy=0;do{len=input[next+copy++];if(state.head&&len&&state.length<65536){state.head.name+=String.fromCharCode(len)}}while(len&&copy<have);if(state.flags&512&&state.wrap&4){state.check=crc32_1(state.check,input,copy,next)}have-=copy;next+=copy;if(len){break inf_leave}}else if(state.head){state.head.name=null}state.length=0;state.mode=COMMENT;case COMMENT:if(state.flags&4096){if(have===0){break inf_leave}copy=0;do{len=input[next+copy++];if(state.head&&len&&state.length<65536){state.head.comment+=String.fromCharCode(len)}}while(len&&copy<have);if(state.flags&512&&state.wrap&4){state.check=crc32_1(state.check,input,copy,next)}have-=copy;next+=copy;if(len){break inf_leave}}else if(state.head){state.head.comment=null}state.mode=HCRC;case HCRC:if(state.flags&512){while(bits<16){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}if(state.wrap&4&&hold!==(state.check&65535)){strm.msg="header crc mismatch";state.mode=BAD;break}hold=0;bits=0}if(state.head){state.head.hcrc=state.flags>>9&1;state.head.done=true}strm.adler=state.check=0;state.mode=TYPE;break;case DICTID:while(bits<32){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}strm.adler=state.check=zswap32(hold);hold=0;bits=0;state.mode=DICT;case DICT:if(state.havedict===0){strm.next_out=put;strm.avail_out=left;strm.next_in=next;strm.avail_in=have;state.hold=hold;state.bits=bits;return Z_NEED_DICT$1}strm.adler=state.check=1;state.mode=TYPE;case TYPE:if(flush===Z_BLOCK||flush===Z_TREES){break inf_leave}case TYPEDO:if(state.last){hold>>>=bits&7;bits-=bits&7;state.mode=CHECK;break}while(bits<3){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}state.last=hold&1;hold>>>=1;bits-=1;switch(hold&3){case 0:state.mode=STORED;break;case 1:fixedtables(state);state.mode=LEN_;if(flush===Z_TREES){hold>>>=2;bits-=2;break inf_leave}break;case 2:state.mode=TABLE;break;case 3:strm.msg="invalid block type";state.mode=BAD}hold>>>=2;bits-=2;break;case STORED:hold>>>=bits&7;bits-=bits&7;while(bits<32){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}if((hold&65535)!==(hold>>>16^65535)){strm.msg="invalid stored block lengths";state.mode=BAD;break}state.length=hold&65535;hold=0;bits=0;state.mode=COPY_;if(flush===Z_TREES){break inf_leave}case COPY_:state.mode=COPY;case COPY:copy=state.length;if(copy){if(copy>have){copy=have}if(copy>left){copy=left}if(copy===0){break inf_leave}output.set(input.subarray(next,next+copy),put);have-=copy;next+=copy;left-=copy;put+=copy;state.length-=copy;break}state.mode=TYPE;break;case TABLE:while(bits<14){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}state.nlen=(hold&31)+257;hold>>>=5;bits-=5;state.ndist=(hold&31)+1;hold>>>=5;bits-=5;state.ncode=(hold&15)+4;hold>>>=4;bits-=4;if(state.nlen>286||state.ndist>30){strm.msg="too many length or distance symbols";state.mode=BAD;break}state.have=0;state.mode=LENLENS;case LENLENS:while(state.have<state.ncode){while(bits<3){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}state.lens[order[state.have++]]=hold&7;hold>>>=3;bits-=3}while(state.have<19){state.lens[order[state.have++]]=0}state.lencode=state.lendyn;state.lenbits=7;opts={bits:state.lenbits};ret=inftrees(CODES,state.lens,0,19,state.lencode,0,state.work,opts);state.lenbits=opts.bits;if(ret){strm.msg="invalid code lengths set";state.mode=BAD;break}state.have=0;state.mode=CODELENS;case CODELENS:while(state.have<state.nlen+state.ndist){for(;;){here=state.lencode[hold&(1<<state.lenbits)-1];here_bits=here>>>24;here_op=here>>>16&255;here_val=here&65535;if(here_bits<=bits){break}if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}if(here_val<16){hold>>>=here_bits;bits-=here_bits;state.lens[state.have++]=here_val}else{if(here_val===16){n=here_bits+2;while(bits<n){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}hold>>>=here_bits;bits-=here_bits;if(state.have===0){strm.msg="invalid bit length repeat";state.mode=BAD;break}len=state.lens[state.have-1];copy=3+(hold&3);hold>>>=2;bits-=2}else if(here_val===17){n=here_bits+3;while(bits<n){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}hold>>>=here_bits;bits-=here_bits;len=0;copy=3+(hold&7);hold>>>=3;bits-=3}else{n=here_bits+7;while(bits<n){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}hold>>>=here_bits;bits-=here_bits;len=0;copy=11+(hold&127);hold>>>=7;bits-=7}if(state.have+copy>state.nlen+state.ndist){strm.msg="invalid bit length repeat";state.mode=BAD;break}while(copy--){state.lens[state.have++]=len}}}if(state.mode===BAD){break}if(state.lens[256]===0){strm.msg="invalid code -- missing end-of-block";state.mode=BAD;break}state.lenbits=9;opts={bits:state.lenbits};ret=inftrees(LENS,state.lens,0,state.nlen,state.lencode,0,state.work,opts);state.lenbits=opts.bits;if(ret){strm.msg="invalid literal/lengths set";state.mode=BAD;break}state.distbits=6;state.distcode=state.distdyn;opts={bits:state.distbits};ret=inftrees(DISTS,state.lens,state.nlen,state.ndist,state.distcode,0,state.work,opts);state.distbits=opts.bits;if(ret){strm.msg="invalid distances set";state.mode=BAD;break}state.mode=LEN_;if(flush===Z_TREES){break inf_leave}case LEN_:state.mode=LEN;case LEN:if(have>=6&&left>=258){strm.next_out=put;strm.avail_out=left;strm.next_in=next;strm.avail_in=have;state.hold=hold;state.bits=bits;inffast(strm,_out);put=strm.next_out;output=strm.output;left=strm.avail_out;next=strm.next_in;input=strm.input;have=strm.avail_in;hold=state.hold;bits=state.bits;if(state.mode===TYPE){state.back=-1}break}state.back=0;for(;;){here=state.lencode[hold&(1<<state.lenbits)-1];here_bits=here>>>24;here_op=here>>>16&255;here_val=here&65535;if(here_bits<=bits){break}if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}if(here_op&&(here_op&240)===0){last_bits=here_bits;last_op=here_op;last_val=here_val;for(;;){here=state.lencode[last_val+((hold&(1<<last_bits+last_op)-1)>>last_bits)];here_bits=here>>>24;here_op=here>>>16&255;here_val=here&65535;if(last_bits+here_bits<=bits){break}if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}hold>>>=last_bits;bits-=last_bits;state.back+=last_bits}hold>>>=here_bits;bits-=here_bits;state.back+=here_bits;state.length=here_val;if(here_op===0){state.mode=LIT;break}if(here_op&32){state.back=-1;state.mode=TYPE;break}if(here_op&64){strm.msg="invalid literal/length code";state.mode=BAD;break}state.extra=here_op&15;state.mode=LENEXT;case LENEXT:if(state.extra){n=state.extra;while(bits<n){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}state.length+=hold&(1<<state.extra)-1;hold>>>=state.extra;bits-=state.extra;state.back+=state.extra}state.was=state.length;state.mode=DIST;case DIST:for(;;){here=state.distcode[hold&(1<<state.distbits)-1];here_bits=here>>>24;here_op=here>>>16&255;here_val=here&65535;if(here_bits<=bits){break}if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}if((here_op&240)===0){last_bits=here_bits;last_op=here_op;last_val=here_val;for(;;){here=state.distcode[last_val+((hold&(1<<last_bits+last_op)-1)>>last_bits)];here_bits=here>>>24;here_op=here>>>16&255;here_val=here&65535;if(last_bits+here_bits<=bits){break}if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}hold>>>=last_bits;bits-=last_bits;state.back+=last_bits}hold>>>=here_bits;bits-=here_bits;state.back+=here_bits;if(here_op&64){strm.msg="invalid distance code";state.mode=BAD;break}state.offset=here_val;state.extra=here_op&15;state.mode=DISTEXT;case DISTEXT:if(state.extra){n=state.extra;while(bits<n){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}state.offset+=hold&(1<<state.extra)-1;hold>>>=state.extra;bits-=state.extra;state.back+=state.extra}if(state.offset>state.dmax){strm.msg="invalid distance too far back";state.mode=BAD;break}state.mode=MATCH;case MATCH:if(left===0){break inf_leave}copy=_out-left;if(state.offset>copy){copy=state.offset-copy;if(copy>state.whave){if(state.sane){strm.msg="invalid distance too far back";state.mode=BAD;break}}if(copy>state.wnext){copy-=state.wnext;from=state.wsize-copy}else{from=state.wnext-copy}if(copy>state.length){copy=state.length}from_source=state.window}else{from_source=output;from=put-state.offset;copy=state.length}if(copy>left){copy=left}left-=copy;state.length-=copy;do{output[put++]=from_source[from++]}while(--copy);if(state.length===0){state.mode=LEN}break;case LIT:if(left===0){break inf_leave}output[put++]=state.length;left--;state.mode=LEN;break;case CHECK:if(state.wrap){while(bits<32){if(have===0){break inf_leave}have--;hold|=input[next++]<<bits;bits+=8}_out-=left;strm.total_out+=_out;state.total+=_out;if(state.wrap&4&&_out){strm.adler=state.check=state.flags?crc32_1(state.check,output,_out,put-_out):adler32_1(state.check,output,_out,put-_out)}_out=left;if(state.wrap&4&&(state.flags?hold:zswap32(hold))!==state.check){strm.msg="incorrect data check";state.mode=BAD;break}hold=0;bits=0}state.mode=LENGTH;case LENGTH:if(state.wrap&&state.flags){while(bits<32){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}if(state.wrap&4&&hold!==(state.total&4294967295)){strm.msg="incorrect length check";state.mode=BAD;break}hold=0;bits=0}state.mode=DONE;case DONE:ret=Z_STREAM_END$1;break inf_leave;case BAD:ret=Z_DATA_ERROR$1;break inf_leave;case MEM:return Z_MEM_ERROR$1;case SYNC:default:return Z_STREAM_ERROR$1}}strm.next_out=put;strm.avail_out=left;strm.next_in=next;strm.avail_in=have;state.hold=hold;state.bits=bits;if(state.wsize||_out!==strm.avail_out&&state.mode<BAD&&(state.mode<CHECK||flush!==Z_FINISH$1)){if(updatewindow(strm,strm.output,strm.next_out,_out-strm.avail_out));}_in-=strm.avail_in;_out-=strm.avail_out;strm.total_in+=_in;strm.total_out+=_out;state.total+=_out;if(state.wrap&4&&_out){strm.adler=state.check=state.flags?crc32_1(state.check,output,_out,strm.next_out-_out):adler32_1(state.check,output,_out,strm.next_out-_out)}strm.data_type=state.bits+(state.last?64:0)+(state.mode===TYPE?128:0)+(state.mode===LEN_||state.mode===COPY_?256:0);if((_in===0&&_out===0||flush===Z_FINISH$1)&&ret===Z_OK$1){ret=Z_BUF_ERROR}return ret};var inflateEnd=function inflateEnd(strm){if(inflateStateCheck(strm)){return Z_STREAM_ERROR$1}var state=strm.state;if(state.window){state.window=null}strm.state=null;return Z_OK$1};var inflateGetHeader=function inflateGetHeader(strm,head){if(inflateStateCheck(strm)){return Z_STREAM_ERROR$1}var state=strm.state;if((state.wrap&2)===0){return Z_STREAM_ERROR$1}state.head=head;head.done=false;return Z_OK$1};var inflateSetDictionary=function inflateSetDictionary(strm,dictionary){var dictLength=dictionary.length;var state;var dictid;var ret;if(inflateStateCheck(strm)){return Z_STREAM_ERROR$1}state=strm.state;if(state.wrap!==0&&state.mode!==DICT){return Z_STREAM_ERROR$1}if(state.mode===DICT){dictid=1;dictid=adler32_1(dictid,dictionary,dictLength,0);if(dictid!==state.check){return Z_DATA_ERROR$1}}ret=updatewindow(strm,dictionary,dictLength,dictLength);if(ret){state.mode=MEM;return Z_MEM_ERROR$1}state.havedict=1;return Z_OK$1};var inflateReset_1=inflateReset;var inflateReset2_1=inflateReset2;var inflateResetKeep_1=inflateResetKeep;var inflateInit_1=inflateInit;var inflateInit2_1=inflateInit2;var inflate_2$1=inflate$2;var inflateEnd_1=inflateEnd;var inflateGetHeader_1=inflateGetHeader;var inflateSetDictionary_1=inflateSetDictionary;var inflateInfo="pako inflate (from Nodeca project)";var inflate_1$2={inflateReset:inflateReset_1,inflateReset2:inflateReset2_1,inflateResetKeep:inflateResetKeep_1,inflateInit:inflateInit_1,inflateInit2:inflateInit2_1,inflate:inflate_2$1,inflateEnd:inflateEnd_1,inflateGetHeader:inflateGetHeader_1,inflateSetDictionary:inflateSetDictionary_1,inflateInfo:inflateInfo};function GZheader(){this.text=0;this.time=0;this.xflags=0;this.os=0;this.extra=null;this.extra_len=0;this.name="";this.comment="";this.hcrc=0;this.done=false}var gzheader=GZheader;var toString=Object.prototype.toString;var Z_NO_FLUSH=constants$2.Z_NO_FLUSH,Z_FINISH=constants$2.Z_FINISH,Z_OK=constants$2.Z_OK,Z_STREAM_END=constants$2.Z_STREAM_END,Z_NEED_DICT=constants$2.Z_NEED_DICT,Z_STREAM_ERROR=constants$2.Z_STREAM_ERROR,Z_DATA_ERROR=constants$2.Z_DATA_ERROR,Z_MEM_ERROR=constants$2.Z_MEM_ERROR;function Inflate$1(options){this.options=common.assign({chunkSize:1024*64,windowBits:15,to:""},options||{});var opt=this.options;if(opt.raw&&opt.windowBits>=0&&opt.windowBits<16){opt.windowBits=-opt.windowBits;if(opt.windowBits===0){opt.windowBits=-15}}if(opt.windowBits>=0&&opt.windowBits<16&&!(options&&options.windowBits)){opt.windowBits+=32}if(opt.windowBits>15&&opt.windowBits<48){if((opt.windowBits&15)===0){opt.windowBits|=15}}this.err=0;this.msg="";this.ended=false;this.chunks=[];this.strm=new zstream;this.strm.avail_out=0;var status=inflate_1$2.inflateInit2(this.strm,opt.windowBits);if(status!==Z_OK){throw new Error(messages[status])}this.header=new gzheader;inflate_1$2.inflateGetHeader(this.strm,this.header);if(opt.dictionary){if(typeof opt.dictionary==="string"){opt.dictionary=strings.string2buf(opt.dictionary)}else if(toString.call(opt.dictionary)==="[object ArrayBuffer]"){opt.dictionary=new Uint8Array(opt.dictionary)}if(opt.raw){status=inflate_1$2.inflateSetDictionary(this.strm,opt.dictionary);if(status!==Z_OK){throw new Error(messages[status])}}}}Inflate$1.prototype.push=function(data,flush_mode){var strm=this.strm;var chunkSize=this.options.chunkSize;var dictionary=this.options.dictionary;var status,_flush_mode,last_avail_out;if(this.ended)return false;if(flush_mode===~~flush_mode)_flush_mode=flush_mode;else _flush_mode=flush_mode===true?Z_FINISH:Z_NO_FLUSH;if(toString.call(data)==="[object ArrayBuffer]"){strm.input=new Uint8Array(data)}else{strm.input=data}strm.next_in=0;strm.avail_in=strm.input.length;for(;;){if(strm.avail_out===0){strm.output=new Uint8Array(chunkSize);strm.next_out=0;strm.avail_out=chunkSize}status=inflate_1$2.inflate(strm,_flush_mode);if(status===Z_NEED_DICT&&dictionary){status=inflate_1$2.inflateSetDictionary(strm,dictionary);if(status===Z_OK){status=inflate_1$2.inflate(strm,_flush_mode)}else if(status===Z_DATA_ERROR){status=Z_NEED_DICT}}while(strm.avail_in>0&&status===Z_STREAM_END&&strm.state.wrap>0&&data[strm.next_in]!==0){inflate_1$2.inflateReset(strm);status=inflate_1$2.inflate(strm,_flush_mode)}switch(status){case Z_STREAM_ERROR:case Z_DATA_ERROR:case Z_NEED_DICT:case Z_MEM_ERROR:this.onEnd(status);this.ended=true;return false}last_avail_out=strm.avail_out;if(strm.next_out){if(strm.avail_out===0||status===Z_STREAM_END){if(this.options.to==="string"){var next_out_utf8=strings.utf8border(strm.output,strm.next_out);var tail=strm.next_out-next_out_utf8;var utf8str=strings.buf2string(strm.output,next_out_utf8);strm.next_out=tail;strm.avail_out=chunkSize-tail;if(tail)strm.output.set(strm.output.subarray(next_out_utf8,next_out_utf8+tail),0);this.onData(utf8str)}else{this.onData(strm.output.length===strm.next_out?strm.output:strm.output.subarray(0,strm.next_out))}}}if(status===Z_OK&&last_avail_out===0)continue;if(status===Z_STREAM_END){status=inflate_1$2.inflateEnd(this.strm);this.onEnd(status);this.ended=true;return true}if(strm.avail_in===0)break}return true};Inflate$1.prototype.onData=function(chunk){this.chunks.push(chunk)};Inflate$1.prototype.onEnd=function(status){if(status===Z_OK){if(this.options.to==="string"){this.result=this.chunks.join("")}else{this.result=common.flattenChunks(this.chunks)}}this.chunks=[];this.err=status;this.msg=this.strm.msg};function inflate$1(input,options){var inflator=new Inflate$1(options);inflator.push(input);if(inflator.err)throw inflator.msg||messages[inflator.err];return inflator.result}function inflateRaw$1(input,options){options=options||{};options.raw=true;return inflate$1(input,options)}var Inflate_1$1=Inflate$1;var inflate_2=inflate$1;var inflateRaw_1$1=inflateRaw$1;var ungzip$1=inflate$1;var constants=constants$2;var inflate_1$1={Inflate:Inflate_1$1,inflate:inflate_2,inflateRaw:inflateRaw_1$1,ungzip:ungzip$1,constants:constants};var ungzip=inflate_1$1.ungzip;var _={};var ArrayProto=Array.prototype,ObjProto=Object.prototype,slice=ArrayProto.slice,nativeToString=ObjProto.toString,nativeHasOwnProperty=Object.prototype.hasOwnProperty,nativeForEach=ArrayProto.forEach,nativeIsArray=Array.isArray,breaker={};_.checkSettings=function(config){if(!config)return undefined;if(_.isStrEmpty(config.appId)||_.isStrEmpty(config.serverUrl))return undefined;config.appId=_.checkAppId(config.appId);config.serverUrl=_.checkUrl(config.serverUrl);if(_.isStrEmpty(config.templateCode)){config.templateCode=Config.TEMPLATE_DEFAULT}return config};_.checkAppId=function(appId){appId=appId.replace(/\s*/g,"");return appId};_.checkUrl=function(url){url=url.replace(/\s*/g,"");url=_.url("basic",url);return url};_.url=function(){function _t(){return new RegExp(/(.*?)\.?([^.]*?)\.(com|net|org|biz|ws|in|me|co\.uk|co|org\.uk|ltd\.uk|plc\.uk|me\.uk|edu|mil|br\.com|cn\.com|eu\.com|hu\.com|no\.com|qc\.com|sa\.com|se\.com|se\.net|us\.com|uy\.com|ac|co\.ac|gv\.ac|or\.ac|ac\.ac|af|am|as|at|ac\.at|co\.at|gv\.at|or\.at|asn\.au|com\.au|edu\.au|org\.au|net\.au|id\.au|be|ac\.be|adm\.br|adv\.br|am\.br|arq\.br|art\.br|bio\.br|cng\.br|cnt\.br|com\.br|ecn\.br|eng\.br|esp\.br|etc\.br|eti\.br|fm\.br|fot\.br|fst\.br|g12\.br|gov\.br|ind\.br|inf\.br|jor\.br|lel\.br|med\.br|mil\.br|net\.br|nom\.br|ntr\.br|odo\.br|org\.br|ppg\.br|pro\.br|psc\.br|psi\.br|rec\.br|slg\.br|tmp\.br|tur\.br|tv\.br|vet\.br|zlg\.br|br|ab\.ca|bc\.ca|mb\.ca|nb\.ca|nf\.ca|ns\.ca|nt\.ca|on\.ca|pe\.ca|qc\.ca|sk\.ca|yk\.ca|ca|cc|ac\.cn|net\.cn|com\.cn|edu\.cn|gov\.cn|org\.cn|bj\.cn|sh\.cn|tj\.cn|cq\.cn|he\.cn|nm\.cn|ln\.cn|jl\.cn|hl\.cn|js\.cn|zj\.cn|ah\.cn|gd\.cn|gx\.cn|hi\.cn|sc\.cn|gz\.cn|yn\.cn|xz\.cn|sn\.cn|gs\.cn|qh\.cn|nx\.cn|xj\.cn|tw\.cn|hk\.cn|mo\.cn|cn|cx|cz|de|dk|fo|com\.ec|tm\.fr|com\.fr|asso\.fr|presse\.fr|fr|gf|gs|co\.il|net\.il|ac\.il|k12\.il|gov\.il|muni\.il|ac\.in|co\.in|org\.in|ernet\.in|gov\.in|net\.in|res\.in|is|it|ac\.jp|co\.jp|go\.jp|or\.jp|ne\.jp|ac\.kr|co\.kr|go\.kr|ne\.kr|nm\.kr|or\.kr|li|lt|lu|asso\.mc|tm\.mc|com\.mm|org\.mm|net\.mm|edu\.mm|gov\.mm|ms|nl|no|nu|pl|ro|org\.ro|store\.ro|tm\.ro|firm\.ro|www\.ro|arts\.ro|rec\.ro|info\.ro|nom\.ro|nt\.ro|se|si|com\.sg|org\.sg|net\.sg|gov\.sg|sk|st|tf|ac\.th|co\.th|go\.th|mi\.th|net\.th|or\.th|tm|to|com\.tr|edu\.tr|gov\.tr|k12\.tr|net\.tr|org\.tr|com\.tw|org\.tw|net\.tw|ac\.uk|uk\.com|uk\.net|gb\.com|gb\.net|vg|sh|kz|ch|info|ua|gov|name|pro|ie|hk|com\.hk|org\.hk|net\.hk|edu\.hk|us|tk|cd|by|ad|lv|eu\.lv|bz|es|jp|cl|ag|mobi|eu|co\.nz|org\.nz|net\.nz|maori\.nz|iwi\.nz|io|la|md|sc|sg|vc|tw|travel|my|se|tv|pt|com\.pt|edu\.pt|asia|fi|com\.ve|net\.ve|fi|org\.ve|web\.ve|info\.ve|co\.ve|tel|im|gr|ru|net\.ru|org\.ru|hr|com\.hr|ly|xyz)$/)}function _d(s){return _.decodeURIComponent(s.replace(/\+/g," "))}function _i(arg,str){var sptr=arg.charAt(0);var split=str.split(sptr);if(sptr===arg){return split}arg=parseInt(arg.substring(1),10);return split[arg<0?split.length+arg:arg-1]}function _f(arg,str){var sptr=arg.charAt(0);var split=str.split("&");var field=[];var params={};var tmp=[];var arg2=arg.substring(1);for(var i=0,ii=split.length;i<ii;i++){field=split[i].match(/(.*?)=(.*)/);if(!field){field=[split[i],split[i],""]}if(field[1].replace(/\s/g,"")!==""){field[2]=_d(field[2]||"");if(arg2===field[1]){return field[2]}tmp=field[1].match(/(.*)\[([0-9]+)\]/);if(tmp){params[tmp[1]]=params[tmp[1]]||[];params[tmp[1]][tmp[2]]=field[2]}else{params[field[1]]=field[2]}}}if(sptr===arg){return params}return params[arg2]}return function(arg,url){var _l={},tmp;if(arg==="tld?"){return _t()}url=url||window.location.toString();if(!arg){return url}arg=arg.toString();if(url.match(/^mailto:([^/].+)/)){tmp=url.match(/^mailto:([^/].+)/);_l.protocol="mailto";_l.email=tmp[1]}else{if(url.match(/(.*?)\/#!(.*)/)){tmp=url.match(/(.*?)\/#!(.*)/);url=tmp[1]+tmp[2]}if(url.match(/(.*?)#(.*)/)){tmp=url.match(/(.*?)#(.*)/);_l.hash=tmp[2];url=tmp[1]}if(_l.hash&&arg.match(/^#/)){return _f(arg,_l.hash)}if(url.match(/(.*?)\?(.*)/)){tmp=url.match(/(.*?)\?(.*)/);_l.query=tmp[2];url=tmp[1]}if(_l.query&&arg.match(/^\?/)){return _f(arg,_l.query)}if(url.match(/(.*?):?\/\/(.*)/)){tmp=url.match(/(.*?):?\/\/(.*)/);_l.protocol=tmp[1].toLowerCase();url=tmp[2]}if(url.match(/(.*?)(\/.*)/)){tmp=url.match(/(.*?)(\/.*)/);_l.path=tmp[2];url=tmp[1]}_l.path=(_l.path||"").replace(/^([^/])/,"/$1").replace(/\/$/,"");if(arg.match(/^[-0-9]+$/)){arg=arg.replace(/^([^/])/,"/$1")}if(arg.match(/^\//)){return _i(arg,_l.path.substring(1))}tmp=_i("/-1",_l.path.substring(1));if(tmp&&(tmp=tmp.match(/(.*?)\.(.*)/))){_l.file=tmp[0];_l.filename=tmp[1];_l.fileext=tmp[2]}if(url.match(/(.*):([0-9]+)$/)){tmp=url.match(/(.*):([0-9]+)$/);_l.port=tmp[2];url=tmp[1]}if(url.match(/(.*?)@(.*)/)){tmp=url.match(/(.*?)@(.*)/);_l.auth=tmp[1];url=tmp[2]}if(_l.auth){tmp=_l.auth.match(/(.*):(.*)/);_l.user=tmp?tmp[1]:_l.auth;_l.pass=tmp?tmp[2]:undefined}_l.hostname=url.toLowerCase();if(arg.charAt(0)==="."){return _i(arg,_l.hostname)}if(_t()){tmp=_l.hostname.match(_t());if(tmp){_l.tld=tmp[3];_l.domain=tmp[2]?tmp[2]+"."+tmp[3]:undefined;_l.sub=tmp[1]||undefined}}var portInfo=_l.port?":"+_l.port:"";_l.protocol=_l.protocol||window.location.protocol.replace(":","");_l.port=_l.port||(_l.protocol==="https"?"443":"80");_l.protocol=_l.protocol||(_l.port==="443"?"https":"http");_l.basic=_l.protocol+"://"+_l.hostname+portInfo}if(arg in _l){return _l[arg]}if(arg==="{}"){return _l}return""}}();_.isStrEmpty=function(str){return!str||str.length===0};_.isArray=nativeIsArray||function(obj){return nativeToString.call(obj)==="[object Array]"};_.UUID=function(){var visitTime=Date.now();var uuid=""+String(Math.random()).replace(".","").slice(1,11)+"-"+visitTime;return uuid};_.each=function(obj,iterator,context){if(obj===null||obj===undefined){return false}if(nativeForEach&&obj.forEach===nativeForEach){obj.forEach(iterator,context)}else if(obj.length===+obj.length){for(var i=0,l=obj.length;i<l;i++){if(i in obj&&iterator.call(context,obj[i],i,obj)===breaker){return false}}}else{for(var key in obj){if(nativeHasOwnProperty.call(obj,key)){if(iterator.call(context,obj[key],key,obj)===breaker){return false}}}}};_.extend=function(obj){_.each(slice.call(arguments,1),(function(source){for(var prop in source){if(source[prop]!==void 0){obj[prop]=source[prop]}}}));return obj};_.extend1=function(obj){_.each(slice.call(arguments,1),(function(source){for(var prop in source){if(source[prop]!==void 0){obj[prop.toLowerCase()]=source[prop]}}}));return obj};_.hexToArrayBuffer=function(hex){var typedArray=new Uint8Array(hex.match(/[\da-f]{2}/gi).map((function(h){return parseInt(h,16)})));return typedArray.buffer};_.sign=function(timeStamp,str){var signStr=_.sha256(timeStamp+str+"thinkingdata-remote-config");return encode(_.hexToArrayBuffer(signStr))};_.sha256=function(s){var chrsz=8;function safe_add(x,y){var lsw=(x&65535)+(y&65535);var msw=(x>>16)+(y>>16)+(lsw>>16);return msw<<16|lsw&65535}function S(X,n){return X>>>n|X<<32-n}function R(X,n){return X>>>n}function Ch(x,y,z){return x&y^~x&z}function Maj(x,y,z){return x&y^x&z^y&z}function Sigma0256(x){return S(x,2)^S(x,13)^S(x,22)}function Sigma1256(x){return S(x,6)^S(x,11)^S(x,25)}function Gamma0256(x){return S(x,7)^S(x,18)^R(x,3)}function Gamma1256(x){return S(x,17)^S(x,19)^R(x,10)}function core_sha256(m,l){var K=new Array(1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298);var HASH=new Array(1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225);var W=new Array(64);var a,b,c,d,e,f,g,h;var T1,T2;m[l>>5]|=128<<24-l%32;m[(l+64>>9<<4)+15]=l;for(var _i2=0;_i2<m.length;_i2+=16){a=HASH[0];b=HASH[1];c=HASH[2];d=HASH[3];e=HASH[4];f=HASH[5];g=HASH[6];h=HASH[7];for(var _j=0;_j<64;_j++){if(_j<16)W[_j]=m[_j+_i2];else W[_j]=safe_add(safe_add(safe_add(Gamma1256(W[_j-2]),W[_j-7]),Gamma0256(W[_j-15])),W[_j-16]);T1=safe_add(safe_add(safe_add(safe_add(h,Sigma1256(e)),Ch(e,f,g)),K[_j]),W[_j]);T2=safe_add(Sigma0256(a),Maj(a,b,c));h=g;g=f;f=e;e=safe_add(d,T1);d=c;c=b;b=a;a=safe_add(T1,T2)}HASH[0]=safe_add(a,HASH[0]);HASH[1]=safe_add(b,HASH[1]);HASH[2]=safe_add(c,HASH[2]);HASH[3]=safe_add(d,HASH[3]);HASH[4]=safe_add(e,HASH[4]);HASH[5]=safe_add(f,HASH[5]);HASH[6]=safe_add(g,HASH[6]);HASH[7]=safe_add(h,HASH[7])}return HASH}function str2binb(str){var bin=Array();var mask=(1<<chrsz)-1;for(var i=0;i<str.length*chrsz;i+=chrsz){bin[i>>5]|=(str.charCodeAt(i/chrsz)&mask)<<24-i%32}return bin}function Utf8Encode(string){string=string.replace(/\r\n/g,"\n");var utftext="";for(var n=0;n<string.length;n++){var c=string.charCodeAt(n);if(c<128){utftext+=String.fromCharCode(c)}else if(c>127&&c<2048){utftext+=String.fromCharCode(c>>6|192);utftext+=String.fromCharCode(c&63|128)}else{utftext+=String.fromCharCode(c>>12|224);utftext+=String.fromCharCode(c>>6&63|128);utftext+=String.fromCharCode(c&63|128)}}return utftext}function binb2hex(binarray){var hex_tab="0123456789abcdef";var str="";for(var i=0;i<binarray.length*4;i++){str+=hex_tab.charAt(binarray[i>>2]>>(3-i%4)*8+4&15)+hex_tab.charAt(binarray[i>>2]>>(3-i%4)*8&15)}return str}s=Utf8Encode(s);return binb2hex(core_sha256(str2binb(s),s.length*chrsz))};_.parseJsonConfig=function(configJson,typeJson){if(configJson&&typeJson){_.each(typeJson,(function(value,key){if(value===Config.DATE_TYPE){var configValue=configJson[key];if(configValue){configJson[key]=new Date(configValue)}}}))}};_.isDate=function(obj){return nativeToString.call(obj)==="[object Date]"};_.isString=function(obj){return nativeToString.call(obj)==="[object String]"};_.isBoolean=function(obj){return nativeToString.call(obj)==="[object Boolean]"};_.isNumber=function(obj){return nativeToString.call(obj)==="[object Number]"&&/[\d\.]+/.test(String(obj))};_.isObject=function(obj){return nativeToString.call(obj)==="[object Object]"&&obj!==null&&obj!==undefined};_.isFunction=function(f){try{return typeof f==="function"}catch(x){return false}};_.stringToBoolean=function(str){switch(str.toLowerCase().trim()){case"true":return true;case"false":return false;default:return undefined}};_.formatDate=function(d){function pad(n){return n<10?"0"+n:n}function secondPad(n){if(n<100&&n>9)return"0"+n;else if(n<10)return"00"+n;else return n}return d.getFullYear()+"-"+pad(d.getMonth()+1)+"-"+pad(d.getDate())+" "+pad(d.getHours())+":"+pad(d.getMinutes())+":"+pad(d.getSeconds())+"."+secondPad(d.getMilliseconds())};_.parseConfigToJson=function(json){if(json){var configJson={};var typeJson={};_.each(json,(function(value,key){if(_.isDate(value)){configJson[key]=_.formatDate(value);typeJson[key]=Config.DATE_TYPE}else{configJson[key]=value}}));return{config:configJson,type:typeJson}}return{}};_.isDebug=function(mode){return mode==="debug"||mode==="debugOnly"};_.parseResponse=function(res){var response=res.data;if(!response.data)return response;var header=res.header;var timeStamp=header["Timestamp"]?header["Timestamp"]:header["timestamp"];var sign=header["Sign"]?header["Sign"]:header["sign"];var dataSign=_.sign(timeStamp,response.data);if(sign!==dataSign){return{code:Config.SIGN_ILLEGAL,msg:"sign illegal"}}response.timeStamp=Number(timeStamp);var decodeData=decode(response.data);var decompressed=ungzip(decodeData);var decodedString=_.arrayBufferToString(decompressed);response.data=JSON.parse(decodedString);return response};_.arrayBufferToString=function(buffer){var bytes=new Uint8Array(buffer);var result="";var i=0;while(i<bytes.length){var byte1=bytes[i];if(byte1<128){result+=String.fromCharCode(byte1);i+=1}else if(byte1>=192&&byte1<224){var byte2=bytes[i+1];result+=String.fromCharCode((byte1&31)<<6|byte2&63);i+=2}else if(byte1>=224&&byte1<240){var _byte=bytes[i+1];var byte3=bytes[i+2];result+=String.fromCharCode((byte1&15)<<12|(_byte&63)<<6|byte3&63);i+=3}else if(byte1>=240&&byte1<248){var _byte2=bytes[i+1];var _byte3=bytes[i+2];var byte4=bytes[i+3];var codepoint=(byte1&7)<<18|(_byte2&63)<<12|(_byte3&63)<<6|byte4&63;codepoint-=65536;result+=String.fromCharCode((codepoint>>10)+55296,(codepoint&1023)+56320);i+=4}}return result};_.paramType=function(param){return Object.prototype.toString.call(param).replace("[object ","").replace("]","")};_.addEvent=function(el,type,fn,useCapture){if(document.addEventListener){if((this.paramType(el)==="Array"||this.paramType(el)==="HTMLCollection")&&el.length&&el!==window){for(var i=0;i<el.length;i++){this.addEvent(el[i],type,fn,useCapture)}}else{el.addEventListener(type,fn,useCapture)}}else{if(el.length&&el!==window){for(var index=0;index<el.length;index++){this.addEvent(el[index],type,fn)}}else{el.attachEvent("on"+type,(function(){return fn.call(el,window.event)}))}}};_.isCCAndroid=function(){if(cc.sys.isNative&&cc.sys.os==="Android"){return true}else{return false}};_.isCCIOS=function(){if(cc.sys.isNative&&cc.sys.os==="iOS"){return true}else{return false}};var logger=_typeof(logger)==="object"?logger:{};logger.info=function(){if((typeof console==="undefined"?"undefined":_typeof(console))==="object"&&console.log&&logger.enabled){try{arguments[0]="[ThinkingData] Info: "+arguments[0];if(logger.listener){logger.listener(arguments[0])}return console.log.apply(console,arguments)}catch(e){if(logger.listener){logger.listener(arguments[0])}console.log("[ThinkingData] Info: "+arguments[0])}}};logger.info1=function(prefix,obj){if(logger.enabled){if(logger.listener){logger.listener(prefix+JSON.stringify(obj))}logger.info(prefix+JSON.stringify(obj,null,4))}};logger.warn=function(){if((typeof console==="undefined"?"undefined":_typeof(console))==="object"&&console.log&&logger.enabled){try{arguments[0]="[ThinkingData] Warning: "+arguments[0];return console.warn.apply(console,arguments)}catch(e){console.warn("[ThinkingData] Warning: "+arguments[0])}}};var TDObject=function(){function TDObject(values){_classCallCheck(this,TDObject);this.keyList=[];if(values){this.configValues=values.first;this.defaultValues=values.second}}return _createClass(TDObject,[{key:"get",value:function get(key,defaultValue){if(this.configValues===undefined)return this;this.keyList.push(key);if(_.isString(key)&&_.isObject(this.configValues)||_.isNumber(key)&&_.isArray(this.configValues)){this.configValues=this.configValues[key]}else{this.configValues=defaultValue}if(this.configValues===undefined&&this.keyList.length<=2){this.configValues=this.getDefaultValue();this.defaultValues=undefined}if(this.configValues===undefined){this.configValues=defaultValue}return this}},{key:"getDefaultValue",value:function getDefaultValue(){if(this.defaultValues===undefined)return undefined;var defaultValue=this.defaultValues;for(var i=0;i<this.keyList.length;i++){var k=this.keyList[i];defaultValue=defaultValue[k];if(defaultValue===undefined){break}}return defaultValue}},{key:"arrayWithFilter",value:function arrayWithFilter(filter){if(!_.isFunction(filter)||this.configValues===undefined)return this;if(_.isArray(this.configValues)){var newJsonArray=[];for(var i=0;i<this.configValues.length;i++){var tdObj=new TDObject({first:this.configValues[i]});if(filter(tdObj)===true){newJsonArray.push(this.configValues[i])}}this.configValues=newJsonArray}else{this.configValues=undefined}return this}},{key:"stringValue",value:function stringValue(){if(this.configValues===undefined)return undefined;if(_.isString(this.configValues)){return this.configValues}else{return String(this.configValues)}}},{key:"numberValue",value:function numberValue(){if(this.configValues===undefined)return undefined;if(_.isNumber(this.configValues)){return this.configValues}else if(_.isString(this.configValues)){var n=Number(this.configValues);if(!Number.isNaN(n)){return n}}return undefined}},{key:"booleanValue",value:function booleanValue(){if(this.configValues===undefined)return undefined;if(_.isBoolean(this.configValues)){return this.configValues}else if(_.isString(this.configValues)){return _.stringToBoolean(this.configValues)}return undefined}},{key:"objectValue",value:function objectValue(){if(this.configValues===undefined)return undefined;if(_.isObject(this.configValues)){return this.configValues}else if(_.isString(this.configValues)){var o=JSON.parse(this.configValues);if(_.isObject(o)){return o}}return undefined}},{key:"arrayValue",value:function arrayValue(){if(this.configValues===undefined)return undefined;if(_.isArray(this.configValues)){return this.configValues}else if(_.isString(this.configValues)){var o=JSON.parse(this.configValues);if(_.isArray(o)){return o}}return undefined}}])}();var runtime=function(exports){var Op=Object.prototype;var hasOwn=Op.hasOwnProperty;var defineProperty=Object.defineProperty||function(obj,key,desc){obj[key]=desc.value};var undefined$1;var $Symbol=typeof Symbol==="function"?Symbol:{};var iteratorSymbol=$Symbol.iterator||"@@iterator";var asyncIteratorSymbol=$Symbol.asyncIterator||"@@asyncIterator";var toStringTagSymbol=$Symbol.toStringTag||"@@toStringTag";function define(obj,key,value){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true});return obj[key]}try{define({},"")}catch(err){define=function(obj,key,value){return obj[key]=value}}function wrap(innerFn,outerFn,self,tryLocsList){var protoGenerator=outerFn&&outerFn.prototype instanceof Generator?outerFn:Generator;var generator=Object.create(protoGenerator.prototype);var context=new Context(tryLocsList||[]);defineProperty(generator,"_invoke",{value:makeInvokeMethod(innerFn,self,context)});return generator}exports.wrap=wrap;function tryCatch(fn,obj,arg){try{return{type:"normal",arg:fn.call(obj,arg)}}catch(err){return{type:"throw",arg:err}}}var GenStateSuspendedStart="suspendedStart";var GenStateSuspendedYield="suspendedYield";var GenStateExecuting="executing";var GenStateCompleted="completed";var ContinueSentinel={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var IteratorPrototype={};define(IteratorPrototype,iteratorSymbol,(function(){return this}));var getProto=Object.getPrototypeOf;var NativeIteratorPrototype=getProto&&getProto(getProto(values([])));if(NativeIteratorPrototype&&NativeIteratorPrototype!==Op&&hasOwn.call(NativeIteratorPrototype,iteratorSymbol)){IteratorPrototype=NativeIteratorPrototype}var Gp=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(IteratorPrototype);GeneratorFunction.prototype=GeneratorFunctionPrototype;defineProperty(Gp,"constructor",{value:GeneratorFunctionPrototype,configurable:true});defineProperty(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:true});GeneratorFunction.displayName=define(GeneratorFunctionPrototype,toStringTagSymbol,"GeneratorFunction");function defineIteratorMethods(prototype){["next","throw","return"].forEach((function(method){define(prototype,method,(function(arg){return this._invoke(method,arg)}))}))}exports.isGeneratorFunction=function(genFun){var ctor=typeof genFun==="function"&&genFun.constructor;return ctor?ctor===GeneratorFunction||(ctor.displayName||ctor.name)==="GeneratorFunction":false};exports.mark=function(genFun){if(Object.setPrototypeOf){Object.setPrototypeOf(genFun,GeneratorFunctionPrototype)}else{genFun.__proto__=GeneratorFunctionPrototype;define(genFun,toStringTagSymbol,"GeneratorFunction")}genFun.prototype=Object.create(Gp);return genFun};exports.awrap=function(arg){return{__await:arg}};function AsyncIterator(generator,PromiseImpl){function invoke(method,arg,resolve,reject){var record=tryCatch(generator[method],generator,arg);if(record.type==="throw"){reject(record.arg)}else{var result=record.arg;var value=result.value;if(value&&typeof value==="object"&&hasOwn.call(value,"__await")){return PromiseImpl.resolve(value.__await).then((function(value){invoke("next",value,resolve,reject)}),(function(err){invoke("throw",err,resolve,reject)}))}return PromiseImpl.resolve(value).then((function(unwrapped){result.value=unwrapped;resolve(result)}),(function(error){return invoke("throw",error,resolve,reject)}))}}var previousPromise;function enqueue(method,arg){function callInvokeWithMethodAndArg(){return new PromiseImpl((function(resolve,reject){invoke(method,arg,resolve,reject)}))}return previousPromise=previousPromise?previousPromise.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}defineProperty(this,"_invoke",{value:enqueue})}defineIteratorMethods(AsyncIterator.prototype);define(AsyncIterator.prototype,asyncIteratorSymbol,(function(){return this}));exports.AsyncIterator=AsyncIterator;exports.async=function(innerFn,outerFn,self,tryLocsList,PromiseImpl){if(PromiseImpl===void 0)PromiseImpl=Promise;var iter=new AsyncIterator(wrap(innerFn,outerFn,self,tryLocsList),PromiseImpl);return exports.isGeneratorFunction(outerFn)?iter:iter.next().then((function(result){return result.done?result.value:iter.next()}))};function makeInvokeMethod(innerFn,self,context){var state=GenStateSuspendedStart;return function invoke(method,arg){if(state===GenStateExecuting){throw new Error("Generator is already running")}if(state===GenStateCompleted){if(method==="throw"){throw arg}return doneResult()}context.method=method;context.arg=arg;while(true){var delegate=context.delegate;if(delegate){var delegateResult=maybeInvokeDelegate(delegate,context);if(delegateResult){if(delegateResult===ContinueSentinel)continue;return delegateResult}}if(context.method==="next"){context.sent=context._sent=context.arg}else if(context.method==="throw"){if(state===GenStateSuspendedStart){state=GenStateCompleted;throw context.arg}context.dispatchException(context.arg)}else if(context.method==="return"){context.abrupt("return",context.arg)}state=GenStateExecuting;var record=tryCatch(innerFn,self,context);if(record.type==="normal"){state=context.done?GenStateCompleted:GenStateSuspendedYield;if(record.arg===ContinueSentinel){continue}return{value:record.arg,done:context.done}}else if(record.type==="throw"){state=GenStateCompleted;context.method="throw";context.arg=record.arg}}}}function maybeInvokeDelegate(delegate,context){var methodName=context.method;var method=delegate.iterator[methodName];if(method===undefined$1){context.delegate=null;if(methodName==="throw"&&delegate.iterator["return"]){context.method="return";context.arg=undefined$1;maybeInvokeDelegate(delegate,context);if(context.method==="throw"){return ContinueSentinel}}if(methodName!=="return"){context.method="throw";context.arg=new TypeError("The iterator does not provide a '"+methodName+"' method")}return ContinueSentinel}var record=tryCatch(method,delegate.iterator,context.arg);if(record.type==="throw"){context.method="throw";context.arg=record.arg;context.delegate=null;return ContinueSentinel}var info=record.arg;if(!info){context.method="throw";context.arg=new TypeError("iterator result is not an object");context.delegate=null;return ContinueSentinel}if(info.done){context[delegate.resultName]=info.value;context.next=delegate.nextLoc;if(context.method!=="return"){context.method="next";context.arg=undefined$1}}else{return info}context.delegate=null;return ContinueSentinel}defineIteratorMethods(Gp);define(Gp,toStringTagSymbol,"Generator");define(Gp,iteratorSymbol,(function(){return this}));define(Gp,"toString",(function(){return"[object Generator]"}));function pushTryEntry(locs){var entry={tryLoc:locs[0]};if(1 in locs){entry.catchLoc=locs[1]}if(2 in locs){entry.finallyLoc=locs[2];entry.afterLoc=locs[3]}this.tryEntries.push(entry)}function resetTryEntry(entry){var record=entry.completion||{};record.type="normal";delete record.arg;entry.completion=record}function Context(tryLocsList){this.tryEntries=[{tryLoc:"root"}];tryLocsList.forEach(pushTryEntry,this);this.reset(true)}exports.keys=function(val){var object=Object(val);var keys=[];for(var key in object){keys.push(key)}keys.reverse();return function next(){while(keys.length){var key=keys.pop();if(key in object){next.value=key;next.done=false;return next}}next.done=true;return next}};function values(iterable){if(iterable!=null){var iteratorMethod=iterable[iteratorSymbol];if(iteratorMethod){return iteratorMethod.call(iterable)}if(typeof iterable.next==="function"){return iterable}if(!isNaN(iterable.length)){var i=-1,next=function next(){while(++i<iterable.length){if(hasOwn.call(iterable,i)){next.value=iterable[i];next.done=false;return next}}next.value=undefined$1;next.done=true;return next};return next.next=next}}throw new TypeError(typeof iterable+" is not iterable")}exports.values=values;function doneResult(){return{value:undefined$1,done:true}}Context.prototype={constructor:Context,reset:function(skipTempReset){this.prev=0;this.next=0;this.sent=this._sent=undefined$1;this.done=false;this.delegate=null;this.method="next";this.arg=undefined$1;this.tryEntries.forEach(resetTryEntry);if(!skipTempReset){for(var name in this){if(name.charAt(0)==="t"&&hasOwn.call(this,name)&&!isNaN(+name.slice(1))){this[name]=undefined$1}}}},stop:function(){this.done=true;var rootEntry=this.tryEntries[0];var rootRecord=rootEntry.completion;if(rootRecord.type==="throw"){throw rootRecord.arg}return this.rval},dispatchException:function(exception){if(this.done){throw exception}var context=this;function handle(loc,caught){record.type="throw";record.arg=exception;context.next=loc;if(caught){context.method="next";context.arg=undefined$1}return!!caught}for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];var record=entry.completion;if(entry.tryLoc==="root"){return handle("end")}if(entry.tryLoc<=this.prev){var hasCatch=hasOwn.call(entry,"catchLoc");var hasFinally=hasOwn.call(entry,"finallyLoc");if(hasCatch&&hasFinally){if(this.prev<entry.catchLoc){return handle(entry.catchLoc,true)}else if(this.prev<entry.finallyLoc){return handle(entry.finallyLoc)}}else if(hasCatch){if(this.prev<entry.catchLoc){return handle(entry.catchLoc,true)}}else if(hasFinally){if(this.prev<entry.finallyLoc){return handle(entry.finallyLoc)}}else{throw new Error("try statement without catch or finally")}}}},abrupt:function(type,arg){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.tryLoc<=this.prev&&hasOwn.call(entry,"finallyLoc")&&this.prev<entry.finallyLoc){var finallyEntry=entry;break}}if(finallyEntry&&(type==="break"||type==="continue")&&finallyEntry.tryLoc<=arg&&arg<=finallyEntry.finallyLoc){finallyEntry=null}var record=finallyEntry?finallyEntry.completion:{};record.type=type;record.arg=arg;if(finallyEntry){this.method="next";this.next=finallyEntry.finallyLoc;return ContinueSentinel}return this.complete(record)},complete:function(record,afterLoc){if(record.type==="throw"){throw record.arg}if(record.type==="break"||record.type==="continue"){this.next=record.arg}else if(record.type==="return"){this.rval=this.arg=record.arg;this.method="return";this.next="end"}else if(record.type==="normal"&&afterLoc){this.next=afterLoc}return ContinueSentinel},finish:function(finallyLoc){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.finallyLoc===finallyLoc){this.complete(entry.completion,entry.afterLoc);resetTryEntry(entry);return ContinueSentinel}}},catch:function(tryLoc){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.tryLoc===tryLoc){var record=entry.completion;if(record.type==="throw"){var thrown=record.arg;resetTryEntry(entry)}return thrown}}throw new Error("illegal catch attempt")},delegateYield:function(iterable,resultName,nextLoc){this.delegate={iterator:values(iterable),resultName:resultName,nextLoc:nextLoc};if(this.method==="next"){this.arg=undefined$1}return ContinueSentinel}};return exports}(typeof module==="object"?module.exports:{});try{regeneratorRuntime=runtime}catch(accidentalStrictMode){if(typeof globalThis==="object"){globalThis.regeneratorRuntime=runtime}}var DB_NAME="thinkingdata";var TABLE_NAME="data";var PlatformProxy=function(){function PlatformProxy(api){_classCallCheck(this,PlatformProxy);this.api=api}return _createClass(PlatformProxy,[{key:"openDb",value:function openDb(){return new Promise((function(resolve,_reject){var request=indexedDB.open(DB_NAME,1);request.onerror=function(_event){resolve(undefined)};request.onsuccess=function(event){resolve(event.target.result)};request.onupgradeneeded=function(event){var db=event.target.result;var objectStore=db.createObjectStore(TABLE_NAME,{keyPath:"id",autoIncrement:true});objectStore.createIndex("key","key",{unique:true})}}))}},{key:"initPageLifeCycle",value:function initPageLifeCycle(callback){if("onvisibilitychange"in document){_.addEvent(document,"visibilitychange",(function(){callback()}))}}},{key:"setStorage",value:function(){var _setStorage=_asyncToGenerator(_regenerator().m((function _callee(name,value,_encrypt){var _this=this;return _regenerator().w((function(_context){while(1)switch(_context.n){case 0:if(this.db){_context.n=2;break}_context.n=1;return this.openDb();case 1:this.db=_context.v;case 2:return _context.a(2,new Promise((function(resolve,_reject){var transaction=_this.db.transaction(TABLE_NAME,"readwrite");var store=transaction.objectStore(TABLE_NAME);var index=store.index("key");var request=index.get(name);request.onsuccess=function(event){var result=event.target.result;if(result){result.value=value;var updateRequest=store.put(result);updateRequest.onsuccess=function(){resolve(true)};updateRequest.onerror=function(_event){resolve(false)}}else{var addRequest=store.add({key:name,value:value});addRequest.onsuccess=function(){resolve(true)};addRequest.onerror=function(_event){resolve(false)}}};request.onerror=function(_event){resolve(false)}})))}}),_callee,this)})));function setStorage(_x,_x2,_x3){return _setStorage.apply(this,arguments)}return setStorage}()},{key:"getStorage",value:function(){var _getStorage=_asyncToGenerator(_regenerator().m((function _callee2(name,_encrypt){var _this2=this;return _regenerator().w((function(_context2){while(1)switch(_context2.n){case 0:if(this.db){_context2.n=2;break}_context2.n=1;return this.openDb();case 1:this.db=_context2.v;case 2:return _context2.a(2,new Promise((function(resolve,_reject){var transaction=_this2.db.transaction(TABLE_NAME,"readonly");var store=transaction.objectStore(TABLE_NAME);var index=store.index("key");var request=index.get(name);request.onsuccess=function(event){var result=event.target.result;if(result){resolve(result.value)}else{resolve(undefined)}};request.onerror=function(_event){resolve(undefined)}})))}}),_callee2,this)})));function getStorage(_x4,_x5){return _getStorage.apply(this,arguments)}return getStorage}()},{key:"readFile",value:function readFile(_path){return"{}"}},{key:"getStorageSync",value:function getStorageSync(_name){return{}}},{key:"request",value:function request(options){return new Promise((function(resolve,_reject){try{var xhr=null;if(window.XMLHttpRequest){xhr=new XMLHttpRequest}else{xhr=new ActiveXObject("Microsoft.XMLHTTP")}xhr.open(options.method,options.url,true);_.each(options.header,(function(value,key){xhr.setRequestHeader(key,value)}));xhr.onreadystatechange=function(){if(xhr.readyState===XMLHttpRequest.DONE){if(xhr.status>=200&&xhr.status<300||xhr.status===304){var allHeaders=xhr.getAllResponseHeaders();var headersArray=allHeaders.trim().split(/[\r\n]+/);var headerMap={};headersArray.forEach((function(line){var parts=line.split(": ");var header=parts.shift();var value=parts.join(": ");headerMap[header]=value}));resolve({data:JSON.parse(xhr.response),header:headerMap})}}};if(options.data){xhr.send(JSON.stringify(options.data))}else{xhr.send()}}catch(e){resolve({data:{code:-10003,msg:"error"},header:{}})}}))}},{key:"getSystemInfo",value:function getSystemInfo(){var ta=this.getAnalyticGlobalData();if(ta){return ta.getPresetProperties().toEventPresetProperties()}return{}}},{key:"isNetWorkConnect",value:function isNetWorkConnect(){if(navigator){return navigator.onLine}return true}},{key:"onNetworkStatusChange",value:function onNetworkStatusChange(listener){this.api.addEventListener("online",(function(){listener({isConnected:true})}));this.api.addEventListener("offline",(function(){listener({isConnected:false})}))}},{key:"getAnalyticGlobalData",value:function getAnalyticGlobalData(){return this.api.tdanalytics2024}},{key:"setGlobalData",value:function setGlobalData(data){this.api.tdremoteconfig2024=data}}],[{key:"createInstance",value:function createInstance(){return new PlatformProxy(window)}}])}();var PlatformAPI=function(){function PlatformAPI(){_classCallCheck(this,PlatformAPI)}return _createClass(PlatformAPI,null,[{key:"_getCurrentPlatform",value:function _getCurrentPlatform(){return this.currentPlatform||(this.currentPlatform=PlatformProxy.createInstance())}},{key:"initPageLifeCycle",value:function initPageLifeCycle(callback){return this._getCurrentPlatform().initPageLifeCycle(callback)}},{key:"setStorage",value:function setStorage(name,value,encrypt){return this._getCurrentPlatform().setStorage(name,value,encrypt)}},{key:"getStorage",value:function getStorage(name,encrypt){return this._getCurrentPlatform().getStorage(name,encrypt)}},{key:"readFile",value:function readFile(path){return this._getCurrentPlatform().readFile(path)}},{key:"getStorageSync",value:function getStorageSync(name){return this._getCurrentPlatform().getStorageSync(name)}},{key:"request",value:function request(options){return this._getCurrentPlatform().request(options)}},{key:"getSystemInfo",value:function getSystemInfo(){return this._getCurrentPlatform().getSystemInfo()}},{key:"isNetWorkConnect",value:function isNetWorkConnect(){return this._getCurrentPlatform().isNetWorkConnect()}},{key:"onNetworkStatusChange",value:function onNetworkStatusChange(listener){return this._getCurrentPlatform().onNetworkStatusChange(listener)}},{key:"getAnalyticGlobalData",value:function getAnalyticGlobalData(){return this._getCurrentPlatform().getAnalyticGlobalData()}},{key:"setGlobalData",value:function setGlobalData(data){this._getCurrentPlatform().setGlobalData(data)}}])}();var AnalyticUtil={};var CLIENT_DEBUG_EVENT="te_ops_client_debug_test";var CLIENT_RISK_EVENT="te_ops_client_risk_record";var TDAnalytics=PlatformAPI.getAnalyticGlobalData();AnalyticUtil.getCurrentTimeStamp=function(){return Date.now()};AnalyticUtil.getCurrentDate=function(){return new Date(Date.now())};AnalyticUtil.trackDebugFailEvent=function(appId,failCode){if(!TDAnalytics)return;TDAnalytics.trackInternal({eventName:CLIENT_DEBUG_EVENT,properties:{"#rcc_pull_result":{business_type:1,is_pull_success:false,pull_fail_code:failCode}},debugMode:"debugOnly"},appId)};AnalyticUtil.trackRiskEvent=function(appId){if(!TDAnalytics)return;TDAnalytics.trackInternal({eventName:CLIENT_RISK_EVENT,properties:{"#ops_risk_type":1}},appId)};AnalyticUtil.getAccountId=function(appId){if(!TDAnalytics)return"";return TDAnalytics.getAccountId(appId)};AnalyticUtil.getDistinctId=function(appId){if(!TDAnalytics)return"";return TDAnalytics.getDistinctId(appId)};AnalyticUtil.getDeviceId=function(){if(!TDAnalytics)return"";return TDAnalytics.getDeviceId()};AnalyticUtil.registerAnalyticsObserver=function(func,appId){if(!TDAnalytics)return;TDAnalytics.registerAnalyticsObserver(func,appId)};var AccountTaskQueue=function(){function AccountTaskQueue(){_classCallCheck(this,AccountTaskQueue);this.tasks=[];this.timeStamp=0}return _createClass(AccountTaskQueue,[{key:"addTask",value:function addTask(taskFunc,args){var task=function(){return taskFunc.apply(this,args)}.bind(this);this.tasks.push(task);this.run()}},{key:"run",value:function(){var _run=_asyncToGenerator(_regenerator().m((function _callee(){var task;return _regenerator().w((function(_context){while(1)switch(_context.n){case 0:if(!(this.tasks.length<=0)){_context.n=1;break}return _context.a(2);case 1:if(!(this.timeStamp===0||AnalyticUtil.getCurrentTimeStamp()-this.timeStamp>3e3)){_context.n=3;break}this.timeStamp=AnalyticUtil.getCurrentTimeStamp();task=this.tasks.shift();_context.n=2;return task();case 2:this.timeStamp=0;this.run();case 3:return _context.a(2)}}),_callee,this)})));function run(){return _run.apply(this,arguments)}return run}()}],[{key:"getInstance",value:function getInstance(){if(!AccountTaskQueue.instance){AccountTaskQueue.instance=new AccountTaskQueue}return AccountTaskQueue.instance}}])}();var ClientUserManager=function(){function ClientUserManager(appId){_classCallCheck(this,ClientUserManager);this.tUsers=appId+"_users"}return _createClass(ClientUserManager,[{key:"loadClientUserId",value:function loadClientUserId(){AccountTaskQueue.getInstance().addTask(_asyncToGenerator(_regenerator().m((function _callee(){var userList,deleteCount;return _regenerator().w((function(_context){while(1)switch(_context.n){case 0:_context.n=1;return PlatformAPI.getStorage(this.tUsers,true);case 1:userList=_context.v;if(!(_.isArray(userList)&&userList.length>1e3)){_context.n=2;break}deleteCount=userList.length-900;userList.splice(0,deleteCount);_context.n=2;return PlatformAPI.setStorage(this.tUsers,userList,true);case 2:return _context.a(2)}}),_callee,this)}))).bind(this))}},{key:"getClientUserId",value:function getClientUserId(accountId,distinctId,callback){AccountTaskQueue.getInstance().addTask(_asyncToGenerator(_regenerator().m((function _callee2(){var userList,user1,clientUserId,user,userDis,i,clientUserId1,clientUserId2;return _regenerator().w((function(_context2){while(1)switch(_context2.n){case 0:_context2.n=1;return PlatformAPI.getStorage(this.tUsers,true);case 1:userList=_context2.v;if(!_.isArray(userList)){userList=[]}if(!_.isStrEmpty(accountId)){_context2.n=5;break}user1=this.findUserByDistinctId(userList,distinctId);if(!user1){_context2.n=2;break}callback(user1.clientUserId);_context2.n=4;break;case 2:clientUserId=_.UUID();_context2.n=3;return this.createNewUser(userList,"",distinctId,clientUserId);case 3:callback(clientUserId);case 4:_context2.n=16;break;case 5:user=undefined;userDis=undefined;for(i=0;i<userList.length;i++){if(userList[i].accountId===accountId){user=userList[i]}if(userList[i].distinctId===distinctId){userDis=userList[i]}}if(user){_context2.n=12;break}if(userDis){_context2.n=7;break}clientUserId1=_.UUID();_context2.n=6;return this.createNewUser(userList,accountId,distinctId,clientUserId1);case 6:callback(clientUserId1);_context2.n=11;break;case 7:if(!_.isStrEmpty(userDis.accountId)){_context2.n=9;break}userDis.accountId=accountId;_context2.n=8;return PlatformAPI.setStorage(this.tUsers,userList,true);case 8:callback(userDis.clientUserId);_context2.n=11;break;case 9:clientUserId2=_.UUID();_context2.n=10;return this.createNewUser(userList,accountId,"",clientUserId2);case 10:callback(clientUserId2);case 11:_context2.n=16;break;case 12:if(userDis){_context2.n=15;break}if(!_.isStrEmpty(user.distinctId)){_context2.n=14;break}user.distinctId=distinctId;_context2.n=13;return PlatformAPI.setStorage(this.tUsers,userList,true);case 13:_context2.n=15;break;case 14:_context2.n=15;return this.createNewUser(userList,user.accountId,distinctId,user.clientUserId);case 15:callback(user.clientUserId);case 16:return _context2.a(2)}}),_callee2,this)}))).bind(this))}},{key:"findUserByDistinctId",value:function findUserByDistinctId(userList,distinctId){for(var i=0;i<userList.length;i++){if(userList[i].distinctId===distinctId){return userList[i]}}return undefined}},{key:"findUserByAccountId",value:function findUserByAccountId(userList,accountId){for(var i=0;i<userList.length;i++){if(userList[i].accountId===accountId){return userList[i]}}return undefined}},{key:"createNewUser",value:function(){var _createNewUser=_asyncToGenerator(_regenerator().m((function _callee3(userList,accountId,distinctId,clientUserId){return _regenerator().w((function(_context3){while(1)switch(_context3.n){case 0:userList.push({accountId:accountId,distinctId:distinctId,clientUserId:clientUserId});_context3.n=1;return PlatformAPI.setStorage(this.tUsers,userList,true);case 1:return _context3.a(2)}}),_callee3,this)})));function createNewUser(_x,_x2,_x3,_x4){return _createNewUser.apply(this,arguments)}return createNewUser}()}],[{key:"getInstance",value:function getInstance(appId){if(!ClientUserManager.instanceMaps){ClientUserManager.instanceMaps={}}if(!ClientUserManager.instanceMaps[appId]){ClientUserManager.instanceMaps[appId]=new ClientUserManager(appId)}return ClientUserManager.instanceMaps[appId]}}])}();var TASK_INTERVAL_NORMAL=3e4;var TASK_INTERVAL_DEBUG=5e3;var TASK_CONTROL_DELAY=6e4;var RemoteTimerTask=function(){function RemoteTimerTask(){_classCallCheck(this,RemoteTimerTask);this.normalTasks=[];this.debugTasks=[];this.callbackList=[];this.controlTimerList={};this.hasRegisterLifeCycle=false}return _createClass(RemoteTimerTask,[{key:"addTimerTaskCallBack",value:function addTimerTaskCallBack(callback){this.callbackList.push(callback)}},{key:"registerPageLifeCycle",value:function registerPageLifeCycle(){var self=this;if(!this.hasRegisterLifeCycle){PlatformAPI.initPageLifeCycle((function(){self.callTimerTask(3)}));this.hasRegisterLifeCycle=true}}},{key:"addNewConfigs",value:function addNewConfigs(config){if(config.debugMode==="debug"||config.debugMode==="debugOnly"){if(!this.isTaskExist(this.debugTasks,config.appId,config.templateCode)){this.debugTasks.push({appId:config.appId,tempCode:config.templateCode,isDebug:true});this.startDebugTimerTask()}}else{if(!this.isTaskExist(this.normalTasks,config.appId,config.templateCode)){this.normalTasks.push({appId:config.appId,tempCode:config.templateCode,isDebug:false});this.startNormalTimerTask()}}}},{key:"startNormalTimerTask",value:function startNormalTimerTask(){var self=this;clearTimeout(this.normalTimer);this.normalTimer=setTimeout((function(){self.callTimerTask(0);self.startNormalTimerTask()}),TASK_INTERVAL_NORMAL)}},{key:"callTimerTask",value:function callTimerTask(code,obj){for(var i=0;i<this.callbackList.length;i++){this.callbackList[i](code,obj)}}},{key:"startDebugTimerTask",value:function startDebugTimerTask(){var self=this;clearTimeout(this.debuglTimer);this.debuglTimer=setTimeout((function(){self.callTimerTask(1);self.startDebugTimerTask()}),TASK_INTERVAL_DEBUG)}},{key:"isTaskExist",value:function isTaskExist(list,appId,tempCode){for(var i=0;i<list.length;i++){if(list[i].appId===appId&&list[i].tempCode===tempCode){return true}}return false}},{key:"removeSystemErrorTask",value:function removeSystemErrorTask(appId,tempCode){this.debugTasks=this.debugTasks.filter((function(item){return item.appId!==appId&&item.tempCode!==tempCode}));this.normalTasks=this.normalTasks.filter((function(item){return item.appId!==appId&&item.tempCode!==tempCode}));if(this.debugTasks.length===0){clearTimeout(this.debuglTimer)}if(this.normalTasks.length===0){clearTimeout(this.normalTimer)}}},{key:"sendFetchControlDelayTask",value:function sendFetchControlDelayTask(appId,tempCode){var self=this;this.controlTimerList[appId+tempCode]=setTimeout((function(){self.callTimerTask(2,{appId:appId,tempCode:tempCode})}),TASK_CONTROL_DELAY)}},{key:"removeDelayTemplateMessage",value:function removeDelayTemplateMessage(appId,tempCode){var timer=this.controlTimerList[appId+tempCode];clearTimeout(timer);this.controlTimerList[appId+tempCode]=undefined}},{key:"debugTaskToNormal",value:function debugTaskToNormal(appId,tempCode){this.debugTasks=this.debugTasks.filter((function(item){return item.appId!==appId&&item.tempCode!==tempCode}));if(this.debugTasks.length===0){clearTimeout(this.debuglTimer)}this.normalTasks.push({appId:appId,tempCode:tempCode,isDebug:false});this.startNormalTimerTask()}}],[{key:"getInstance",value:function getInstance(){if(!RemoteTimerTask.instance){RemoteTimerTask.instance=new RemoteTimerTask}return RemoteTimerTask.instance}}])}();var TDTemplateSetting=function(){function TDTemplateSetting(config,appSetting){_classCallCheck(this,TDTemplateSetting);this.config=config;this.appSetting=appSetting;this.customParams={};this.requestControlCount=0;this.lastFetchTime=0;this.mFetchListeners=[];this.defaultConfigKey=this.config.appId+"_"+this.config.templateCode+"_default_configs";this.fetchConfigKey=this.config.appId+"_"+this.config.templateCode+"_fetch_configs";this.tempInfoKey=this.config.appId+"_"+this.config.templateCode+"_infos";this.parseServerUrl();this.mergeCustomFetchParams(this.config.customFetchParams)}return _createClass(TDTemplateSetting,[{key:"initTemplateAsync",value:function(){var _initTemplateAsync=_asyncToGenerator(_regenerator().m((function _callee(){var defaultConfig,fetchConfig;return _regenerator().w((function(_context){while(1)switch(_context.n){case 0:_context.n=1;return PlatformAPI.getStorage(this.tempInfoKey);case 1:this.templateInfo=_context.v;if(!this.templateInfo){this.templateInfo={}}_context.n=2;return PlatformAPI.getStorage(this.defaultConfigKey);case 2:defaultConfig=_context.v;this.loadDefaultValues(defaultConfig);_context.n=3;return PlatformAPI.getStorage(this.fetchConfigKey);case 3:fetchConfig=_context.v;this.loadFetchValues(fetchConfig);case 4:return _context.a(2)}}),_callee,this)})));function initTemplateAsync(){return _initTemplateAsync.apply(this,arguments)}return initTemplateAsync}()},{key:"loadDefaultValues",value:function loadDefaultValues(localConfig){if(localConfig&&!this.defaultParams){var configJson=localConfig.config;var typeJson=localConfig.type;if(configJson&&typeJson){_.parseJsonConfig(configJson,typeJson);this.defaultParams={};_.extend(this.defaultParams,configJson)}}if(!this.defaultParams){this.defaultParams={}}}},{key:"loadFetchValues",value:function loadFetchValues(localConfig){if(localConfig){var configJson=localConfig.config;var typeJson=localConfig.type;if(localConfig.expirationPeriod){this.expirationTime=localConfig.expirationPeriod}if(configJson&&typeJson){_.parseJsonConfig(configJson,typeJson);if(!this.applyConfigs){this.applyConfigs={}}_.extend(this.applyConfigs,configJson)}}if(!this.applyConfigs){this.applyConfigs={}}}},{key:"parseServerUrl",value:function parseServerUrl(){if(_.isDebug(this.config.debugMode)){this.serverUrl=this.config.serverUrl+"/v1/remote-config/debug"}else{this.serverUrl=this.config.serverUrl+"/v1/remote-config/get"}}},{key:"getTempCode",value:function getTempCode(){if(this.config.templateCode===Config.TEMPLATE_DEFAULT){return""}return this.config.templateCode}},{key:"getConfigTempCode",value:function getConfigTempCode(){return this.config.templateCode}},{key:"getServerUrl",value:function getServerUrl(){return this.serverUrl}},{key:"mergeCustomFetchParams",value:function mergeCustomFetchParams(params){if(params){_.extend(this.customParams,params);logger.info1("custom fetch params result :",this.customParams)}}},{key:"removeCustomParams",value:function removeCustomParams(key){if(key){delete this.customParams[key];logger.info1("custom fetch params result :",this.customParams)}}},{key:"mergeDefaultParams",value:function mergeDefaultParams(params){if(params){if(!this.defaultParams){var defaultConfig=PlatformAPI.getStorageSync(this.defaultConfigKey);this.loadDefaultValues(defaultConfig)}_.extend(this.defaultParams,params);logger.info1("default params result :",this.defaultParams);var newDefault=_.parseConfigToJson(this.defaultParams);PlatformAPI.setStorage(this.defaultConfigKey,newDefault)}}},{key:"clearDefaultParams",value:function clearDefaultParams(){this.defaultParams={};logger.info("clear default params");PlatformAPI.setStorage(this.defaultConfigKey,{})}},{key:"addConfigFetchListener",value:function addConfigFetchListener(listener){this.mFetchListeners.push(listener)}},{key:"getCustomParams",value:function getCustomParams(){return this.customParams}},{key:"updateRemoteConfigs",value:function(){var _updateRemoteConfigs=_asyncToGenerator(_regenerator().m((function _callee2(response){var data,configJson,typeJson,templateInfoJson,expiration,strategy,time,newJson,statusJson,j;return _regenerator().w((function(_context2){while(1)switch(_context2.n){case 0:if(response){_context2.n=1;break}return _context2.a(2);case 1:data=response.data;if(data){_context2.n=2;break}return _context2.a(2);case 2:this.updateLastFetchTime();this.templateInfo.lastFetchStamp=response.timeStamp;PlatformAPI.setStorage(this.tempInfoKey,this.templateInfo);configJson=data.config;typeJson=data.type;if(!(!configJson||!typeJson)){_context2.n=3;break}return _context2.a(2);case 3:templateInfoJson=data.templateInfo;expiration=0;if(templateInfoJson){strategy=templateInfoJson.activationStrategy;expiration=templateInfoJson.expirationPeriod}if(!expiration||expiration<=0){expiration=Config.CONFIG_EXPIRED_TIME}time=AnalyticUtil.getCurrentTimeStamp()/1e3+expiration;newJson={config:configJson,type:typeJson,expirationPeriod:time};PlatformAPI.setStorage(this.fetchConfigKey,newJson);if(strategy===Config.ACTIVATION_STRATEGY_IMMEDIATELY){this.expirationTime=time;this.activationSrategy=strategy;_.parseJsonConfig(configJson,typeJson);if(!this.applyConfigs){this.applyConfigs={}}_.extend(this.applyConfigs,configJson);if(this.config.remoteconfigObserver){this.config.remoteconfigObserver("onConfigApplySuccess",{appId:this.config.appId,templateCode:this.getConfigTempCode(),clientUserId:this.appSetting.getClientUserId()})}statusJson={strategy_status_map:configJson["strategyStatusMap"]};for(j=0;j<this.mFetchListeners.length;j++){this.mFetchListeners[j](statusJson)}}case 4:return _context2.a(2)}}),_callee2,this)})));function updateRemoteConfigs(_x){return _updateRemoteConfigs.apply(this,arguments)}return updateRemoteConfigs}()},{key:"isStrategyNoExpired",value:function isStrategyNoExpired(){if(this.activationSrategy===Config.ACTIVATION_STRATEGY_NEXT){return true}return!this.isExpired()}},{key:"isFetchExpired",value:function isFetchExpired(){return AnalyticUtil.getCurrentTimeStamp()-this.templateInfo.lastFetchStamp>6*3600*1e3}},{key:"isExpired",value:function isExpired(){if(this.expirationTime){var isExpired=AnalyticUtil.getCurrentTimeStamp()/1e3>this.expirationTime;if(isExpired){logger.info("remote config is expired")}return isExpired}return false}},{key:"loadParamsSync",value:function loadParamsSync(){if(!this.defaultParams){var defaultConfig=PlatformAPI.getStorageSync(this.defaultConfigKey);this.loadDefaultValues(defaultConfig)}if(!this.applyConfigs){var fetchConfig=PlatformAPI.getStorageSync(this.fetchConfigKey);this.loadFetchValues(fetchConfig)}}},{key:"getAll",value:function getAll(){this.loadParamsSync();var all={second:this.defaultParams};if(this.isStrategyNoExpired()){all.first=this.applyConfigs}return all}},{key:"uploadDebugEvent",value:function uploadDebugEvent(code){if(!_.isDebug(this.config.debugMode))return;if(this.hasSendDebugEvent)return;this.hasSendDebugEvent=true;AnalyticUtil.trackDebugFailEvent(this.config.appId,code)}},{key:"downGradeMode",value:function downGradeMode(){if(_.isDebug(this.config.debugMode)){this.config.debugMode="normal";this.parseServerUrl();RemoteTimerTask.getInstance().debugTaskToNormal(this.config.appId,this.getConfigTempCode())}}},{key:"clearOldConfig",value:function(){var _clearOldConfig=_asyncToGenerator(_regenerator().m((function _callee3(){return _regenerator().w((function(_context3){while(1)switch(_context3.n){case 0:this.applyConfigs={};_context3.n=1;return PlatformAPI.setStorage(this.fetchConfigKey,{});case 1:return _context3.a(2)}}),_callee3,this)})));function clearOldConfig(){return _clearOldConfig.apply(this,arguments)}return clearOldConfig}()},{key:"addRequestCount",value:function addRequestCount(){if(_.isDebug(this.config.debugMode))return;this.requestControlCount++}},{key:"updateLastFetchTime",value:function updateLastFetchTime(){if(_.isDebug(this.config.debugMode))return;var currentTimeMinute=AnalyticUtil.getCurrentDate().getMinutes();if(currentTimeMinute!==this.lastFetchTime){this.requestControlCount=1}this.lastFetchTime=currentTimeMinute}},{key:"isRequestControl",value:function isRequestControl(){if(_.isDebug(this.config.debugMode))return false;if(AnalyticUtil.getCurrentDate().getMinutes()===this.lastFetchTime){var isControl=this.requestControlCount>3;if(isControl){logger.info("fetch config too frequently , try again 60s later");RemoteTimerTask.getInstance().sendFetchControlDelayTask(this.config.appId,this.config.templateCode)}return isControl}return false}},{key:"notifyConfigChanged",value:function(){var _notifyConfigChanged=_asyncToGenerator(_regenerator().m((function _callee4(clinetUserId){var uid;return _regenerator().w((function(_context4){while(1)switch(_context4.n){case 0:uid=clinetUserId;if(!uid){uid=this.appSetting.getClientUserId()}if(this.config.remoteconfigObserver){this.config.remoteconfigObserver("onConfigChanged",{appId:this.config.appId,templateCode:this.getConfigTempCode(),clientUserId:uid})}case 1:return _context4.a(2)}}),_callee4,this)})));function notifyConfigChanged(_x2){return _notifyConfigChanged.apply(this,arguments)}return notifyConfigChanged}()}])}();var TD_SYSTEM_CONFIG="td_system_config";var RCC_CLIENT="rcc_client";var SystemConfig=function(){function SystemConfig(){_classCallCheck(this,SystemConfig);this.loadFlags={};this.systemConfigs=[]}return _createClass(SystemConfig,[{key:"loadLocalConfig",value:function(){var _loadLocalConfig=_asyncToGenerator(_regenerator().m((function _callee(config){var configList,i,conf;return _regenerator().w((function(_context){while(1)switch(_context.n){case 0:if(!this.isFindAppIdConfig(config.appId)){_context.n=1;break}return _context.a(2);case 1:_context.n=2;return PlatformAPI.getStorage(TD_SYSTEM_CONFIG);case 2:configList=_context.v;if(!this.loadFlags[config.appId]){if(_.isArray(configList)){for(i=0;i<configList.length;i++){conf=configList[i];if(conf.appId===config.appId&&conf.plat===RCC_CLIENT){this.systemConfigs.push(conf)}}}this.loadFlags[config.appId]=true}this.fetchRemoteSystemConfig(config.appId,config.serverUrl);case 3:return _context.a(2)}}),_callee,this)})));function loadLocalConfig(_x){return _loadLocalConfig.apply(this,arguments)}return loadLocalConfig}()},{key:"fetchRemoteSystemConfig",value:function(){var _fetchRemoteSystemConfig=_asyncToGenerator(_regenerator().m((function _callee2(appId,serverUrl){var _this=this;var res,data,configList;return _regenerator().w((function(_context2){while(1)switch(_context2.n){case 0:_context2.n=1;return PlatformAPI.request({url:serverUrl+"/v1/remote-config/config?appid="+appId,method:"GET"});case 1:res=_context2.v;data=res.data;if(data){_context2.n=2;break}return _context2.a(2);case 2:logger.info1("Get system config success : ",data);_context2.n=3;return PlatformAPI.getStorage(TD_SYSTEM_CONFIG);case 3:configList=_context2.v;if(!_.isArray(configList)){configList=[]}this.systemConfigs=this.systemConfigs.filter((function(item){return item.appId!==appId}));configList=configList.filter((function(item){return item.appId!==appId}));_.each(data,(function(value,key){var conf={appId:appId,plat:key,disabled:value["disabled"],disabledVersionList:value["disabled_version_list"]};if(key===RCC_CLIENT){_this.systemConfigs.push(conf)}configList.push(conf)}));_context2.n=4;return PlatformAPI.setStorage(TD_SYSTEM_CONFIG,configList);case 4:return _context2.a(2)}}),_callee2,this)})));function fetchRemoteSystemConfig(_x2,_x3){return _fetchRemoteSystemConfig.apply(this,arguments)}return fetchRemoteSystemConfig}()},{key:"isFindAppIdConfig",value:function isFindAppIdConfig(appId){for(var i=0;i<this.systemConfigs.length;i++){if(this.systemConfigs[i].appId===appId){return true}}return false}},{key:"isRCCStop",value:function isRCCStop(appId){if(!this.loadFlags[appId]){var configList=PlatformAPI.getStorageSync(TD_SYSTEM_CONFIG);if(_.isArray(configList)){for(var i=0;i<configList.length;i++){var con=configList[i];if(con.appId===appId&&con.plat===RCC_CLIENT){this.systemConfigs.push(con)}}}if(this.systemConfigs.length>0){this.loadFlags[appId]=true}}for(var _i=0;_i<this.systemConfigs.length;_i++){var conf=this.systemConfigs[_i];if(conf.appId===appId){if(conf.disabled)return true;for(var j=0;j<conf.disabledVersionList.length;j++){if(conf.disabledVersionList[_i]===Config.LIB_VERSION){return true}}}}return false}}],[{key:"getInstance",value:function getInstance(){if(!SystemConfig.instance){SystemConfig.instance=new SystemConfig}return SystemConfig.instance}}])}();var TDAppSetting=function(){function TDAppSetting(config){_classCallCheck(this,TDAppSetting);this.appId=config.appId;this.templateSettings={};this.tUsers=this.appId+"_users";this.localUserKey=this.appId+"_localUser";this.addTemplateCode(config)}return _createClass(TDAppSetting,[{key:"initAsync",value:function(){var _initAsync=_asyncToGenerator(_regenerator().m((function _callee(tempCode){var template;return _regenerator().w((function(_context){while(1)switch(_context.n){case 0:ClientUserManager.getInstance(this.appId).loadClientUserId();_context.n=1;return this.getClientUserIdAsync(this.getAccountId(),this.getDistinctId());case 1:this.clientUserId=_context.v;template=this.getTemplateSetting(tempCode);if(!template){_context.n=2;break}_context.n=2;return template.initTemplateAsync();case 2:return _context.a(2)}}),_callee,this)})));function initAsync(_x){return _initAsync.apply(this,arguments)}return initAsync}()},{key:"getTemplateSetting",value:function getTemplateSetting(tempCode){if(SystemConfig.getInstance().isRCCStop(this.appId))return undefined;if(_.isStrEmpty(tempCode)){return this.templateSettings[Config.TEMPLATE_DEFAULT]}return this.templateSettings[tempCode]}},{key:"addTemplateCode",value:function addTemplateCode(config){if(this.templateSettings[config.templateCode]){return false}var templateSetting=new TDTemplateSetting(config,this);this.templateSettings[config.templateCode]=templateSetting;return true}},{key:"getAppId",value:function getAppId(){return this.appId}},{key:"getAccountId",value:function getAccountId(){return AnalyticUtil.getAccountId(this.appId)}},{key:"getDistinctId",value:function getDistinctId(){return AnalyticUtil.getDistinctId(this.appId)}},{key:"getClientUserId",value:function getClientUserId(){return this.clientUserId}},{key:"getClientUserIdAsync",value:function(){var _getClientUserIdAsync=_asyncToGenerator(_regenerator().m((function _callee2(accountId,distinctId){var _this=this;return _regenerator().w((function(_context2){while(1)switch(_context2.n){case 0:return _context2.a(2,new Promise((function(resolve,_reject){ClientUserManager.getInstance(_this.appId).getClientUserId(accountId,distinctId,(function(cuid){resolve(cuid)}))})))}}),_callee2)})));function getClientUserIdAsync(_x2,_x3){return _getClientUserIdAsync.apply(this,arguments)}return getClientUserIdAsync}()},{key:"updateAppConfigs",value:function(){var _updateAppConfigs=_asyncToGenerator(_regenerator().m((function _callee3(data){var userId,templateInfo,userIdPeriod,expiredTime,lastLocalUser,localUser;return _regenerator().w((function(_context3){while(1)switch(_context3.n){case 0:if(data){_context3.n=1;break}return _context3.a(2);case 1:userId=data.localUserId;if(!(userId&&userId>0)){_context3.n=4;break}templateInfo=data.templateInfo;if(templateInfo){_context3.n=2;break}return _context3.a(2);case 2:userIdPeriod=templateInfo.userIdPeriod;if(!userIdPeriod||userIdPeriod<0){userIdPeriod=Config.USER_ID_EXPIRED_TIME}expiredTime=AnalyticUtil.getCurrentTimeStamp()/1e3+userIdPeriod;_context3.n=3;return PlatformAPI.getStorage(this.localUserKey);case 3:lastLocalUser=_context3.v;if(!lastLocalUser){lastLocalUser={}}localUser={localUserId:userId,userIdExpiredTime:expiredTime,lastClientUserId:lastLocalUser.lastClientUserId,lastAccountId:lastLocalUser.lastAccountId};_context3.n=4;return PlatformAPI.setStorage(this.localUserKey,localUser);case 4:return _context3.a(2)}}),_callee3,this)})));function updateAppConfigs(_x4){return _updateAppConfigs.apply(this,arguments)}return updateAppConfigs}()},{key:"getLocalUserId",value:function(){var _getLocalUserId=_asyncToGenerator(_regenerator().m((function _callee4(){var localUser;return _regenerator().w((function(_context4){while(1)switch(_context4.n){case 0:_context4.n=1;return PlatformAPI.getStorage(this.localUserKey);case 1:localUser=_context4.v;if(localUser){_context4.n=2;break}return _context4.a(2,"");case 2:if(!(localUser.userIdExpiredTime===-1)){_context4.n=3;break}return _context4.a(2,"");case 3:if(!(AnalyticUtil.getCurrentTimeStamp()/1e3>localUser.userIdExpiredTime)){_context4.n=4;break}logger.info("local userId has expired and has been cleared");return _context4.a(2,"");case 4:return _context4.a(2,localUser.localUserId)}}),_callee4,this)})));function getLocalUserId(){return _getLocalUserId.apply(this,arguments)}return getLocalUserId}()},{key:"doChangeAccount",value:function(){var _doChangeAccount=_asyncToGenerator(_regenerator().m((function _callee5(accountId,clientUserId){var localUser,isFistChangeAccount,lastClientUserId,isClientUserIdChange,lastAccountId,isAccountIdChange;return _regenerator().w((function(_context5){while(1)switch(_context5.n){case 0:_context5.n=1;return PlatformAPI.getStorage(this.localUserKey);case 1:localUser=_context5.v;if(!localUser){localUser={}}isFistChangeAccount=true;lastClientUserId=localUser.lastClientUserId;if(lastClientUserId){isFistChangeAccount=false}isClientUserIdChange=lastClientUserId!==clientUserId;if(isClientUserIdChange){localUser.lastClientUserId=clientUserId}lastAccountId=localUser.lastAccountId;isAccountIdChange=lastAccountId!==accountId;if(isAccountIdChange){localUser.lastAccountId=accountId}this.clientUserId=clientUserId;if(isClientUserIdChange||isAccountIdChange){localUser.localUserId="";localUser.userIdExpiredTime=-1}_context5.n=2;return PlatformAPI.setStorage(this.localUserKey,localUser);case 2:return _context5.a(2,{isFirstChange:isFistChangeAccount,isChangeAccount:isClientUserIdChange||isAccountIdChange})}}),_callee5,this)})));function doChangeAccount(_x5,_x6){return _doChangeAccount.apply(this,arguments)}return doChangeAccount}()}])}();var RemoteTaskQueue=function(){function RemoteTaskQueue(){_classCallCheck(this,RemoteTaskQueue);this.tasks=[];this.timeStamp=0}return _createClass(RemoteTaskQueue,[{key:"addTask",value:function addTask(taskFunc){var task=function(){return taskFunc.apply(this)}.bind(this);this.tasks.push(task);this.run()}},{key:"run",value:function(){var _run=_asyncToGenerator(_regenerator().m((function _callee(){var task;return _regenerator().w((function(_context){while(1)switch(_context.n){case 0:if(!(this.tasks.length<=0)){_context.n=1;break}return _context.a(2);case 1:if(!(this.timeStamp===0||Date.now()-this.timeStamp>15e3)){_context.n=3;break}this.timeStamp=Date.now();task=this.tasks.shift();_context.n=2;return task();case 2:this.timeStamp=0;this.run();case 3:return _context.a(2)}}),_callee,this)})));function run(){return _run.apply(this,arguments)}return run}()}],[{key:"getInstance",value:function getInstance(){if(!RemoteTaskQueue.instance){RemoteTaskQueue.instance=new RemoteTaskQueue}return RemoteTaskQueue.instance}}])}();var TDRemoteAPI=function(){function TDRemoteAPI(config){_classCallCheck(this,TDRemoteAPI);logger.enabled=config.enableLog;this.tempNetStatusList=[];this.accountTaskQueue=new AccountTaskQueue;this.mAppSetting=new TDAppSetting(config);RemoteTimerTask.getInstance().addTimerTaskCallBack(this.onTimerTaskCallBack.bind(this));var _that=this;AnalyticUtil.registerAnalyticsObserver((function(type,obj){_that.doAnalyticsObserver(type,obj)}),config.appId);PlatformAPI.onNetworkStatusChange((function(res){_that.doNetWorkChanged(res)}))}return _createClass(TDRemoteAPI,[{key:"_init",value:function(){var _init2=_asyncToGenerator(_regenerator().m((function _callee2(config){return _regenerator().w((function(_context2){while(1)switch(_context2.n){case 0:RemoteTaskQueue.getInstance().addTask(_asyncToGenerator(_regenerator().m((function _callee(){return _regenerator().w((function(_context){while(1)switch(_context.n){case 0:_context.n=1;return SystemConfig.getInstance().loadLocalConfig(config);case 1:if(!SystemConfig.getInstance().isRCCStop(config.appId)){_context.n=2;break}return _context.a(2);case 2:if(TDRemoteAPI.systemInfos){_context.n=4;break}_context.n=3;return PlatformAPI.getSystemInfo();case 3:TDRemoteAPI.systemInfos=_context.v;case 4:_context.n=5;return this.mAppSetting.initAsync(config.templateCode);case 5:RemoteTimerTask.getInstance().registerPageLifeCycle(config);RemoteTimerTask.getInstance().addNewConfigs(config);_context.n=6;return this.fetchWithTempCode(config.templateCode,3,false);case 6:logger.info("TDRemoteConfig SDK initialize success with appId = "+config.appId+" , templateCode = "+config.templateCode+" , version = "+Config.LIB_VERSION);case 7:return _context.a(2)}}),_callee,this)}))).bind(this));case 1:return _context2.a(2)}}),_callee2,this)})));function _init(_x){return _init2.apply(this,arguments)}return _init}()},{key:"setCustomFetchParams",value:function setCustomFetchParams(fetchParams,tempCode){var tempSetting=this.mAppSetting.getTemplateSetting(tempCode);if(tempSetting){RemoteTaskQueue.getInstance().addTask((function(){tempSetting.mergeCustomFetchParams(fetchParams)}))}}},{key:"removeCustomFetchParams",value:function removeCustomFetchParams(key,tempCode){var tempSetting=this.mAppSetting.getTemplateSetting(tempCode);if(tempSetting){RemoteTaskQueue.getInstance().addTask((function(){tempSetting.removeCustomParams(key)}))}}},{key:"applyDefaultParams",value:function applyDefaultParams(defaultParams,tempCode){var tempSetting=this.mAppSetting.getTemplateSetting(tempCode);if(tempSetting){tempSetting.mergeDefaultParams(defaultParams)}}},{key:"clearDefaultParams",value:function clearDefaultParams(tempCode){var tempSetting=this.mAppSetting.getTemplateSetting(tempCode);if(tempSetting){tempSetting.clearDefaultParams()}}},{key:"applyDefaultParamsWithJsonFile",value:function(){var _applyDefaultParamsWithJsonFile=_asyncToGenerator(_regenerator().m((function _callee3(path,tempCode){var tempSetting,dataStr;return _regenerator().w((function(_context3){while(1)switch(_context3.n){case 0:tempSetting=this.mAppSetting.getTemplateSetting(tempCode);if(!tempSetting){_context3.n=2;break}_context3.n=1;return PlatformAPI.readFile(path);case 1:dataStr=_context3.v;tempSetting.mergeDefaultParams(JSON.parse(dataStr));case 2:return _context3.a(2)}}),_callee3,this)})));function applyDefaultParamsWithJsonFile(_x2,_x3){return _applyDefaultParamsWithJsonFile.apply(this,arguments)}return applyDefaultParamsWithJsonFile}()},{key:"addConfigFetchListener",value:function addConfigFetchListener(listener,tempCode){if(!_.isFunction(listener))return;var tempSetting=this.mAppSetting.getTemplateSetting(tempCode);if(tempSetting){tempSetting.addConfigFetchListener(listener)}}},{key:"getAll",value:function getAll(tempCode){var tempSetting=this.mAppSetting.getTemplateSetting(tempCode);if(tempSetting){return tempSetting.getAll()}return undefined}},{key:"fetchWithTempCode",value:function(){var _fetchWithTempCode=_asyncToGenerator(_regenerator().m((function _callee4(tempCode,retryCount,isNeedControl,account,distinct){var tempSetting,aid,did,postJson,_t,_t2,_t3,_t4,_t5,_t6,_t7;return _regenerator().w((function(_context4){while(1)switch(_context4.n){case 0:tempSetting=this.mAppSetting.getTemplateSetting(tempCode);if(tempSetting){_context4.n=1;break}return _context4.a(2);case 1:if(!(isNeedControl&&tempSetting.isRequestControl())){_context4.n=2;break}return _context4.a(2);case 2:aid=account?account:this.mAppSetting.getAccountId();did=distinct?distinct:this.mAppSetting.getDistinctId();_t=this;_t2=tempSetting;_t3=aid;_t4=did;_context4.n=3;return this.mAppSetting.getLocalUserId();case 3:_t5=_context4.v;_t6=this.mAppSetting.getClientUserId();_t7={accountId:_t3,distinctId:_t4,userId:_t5,clientUserId:_t6};postJson=_t.obtainPostParams.call(_t,_t2,_t7);_context4.n=4;return this.fetchAsync(tempSetting,retryCount,postJson,isNeedControl);case 4:return _context4.a(2)}}),_callee4,this)})));function fetchWithTempCode(_x4,_x5,_x6,_x7,_x8){return _fetchWithTempCode.apply(this,arguments)}return fetchWithTempCode}()},{key:"fetchAsync",value:function(){var _fetchAsync=_asyncToGenerator(_regenerator().m((function _callee5(tempSetting,retryCount,postJson,isNeedControl){var isNetConnect,timeStamp,sign,res,response;return _regenerator().w((function(_context5){while(1)switch(_context5.n){case 0:_context5.n=1;return PlatformAPI.isNetWorkConnect();case 1:isNetConnect=_context5.v;if(isNetConnect){_context5.n=2;break}this.tempNetStatusList.push(tempSetting.getConfigTempCode());return _context5.a(2);case 2:tempSetting.addRequestCount();if(!(isNeedControl&&tempSetting.isRequestControl())){_context5.n=3;break}return _context5.a(2);case 3:timeStamp=AnalyticUtil.getCurrentTimeStamp();sign=_.sign(timeStamp,JSON.stringify(postJson));logger.info1("fetch config start with appId = "+this.mAppSetting.getAppId()+" template = "+tempSetting.getConfigTempCode()+" params = ",postJson);_context5.n=4;return PlatformAPI.request({url:tempSetting.getServerUrl(),header:{"Content-Type":"application/json",device_id:postJson["request_params"]["#device_id"],template_code:postJson["template_code"],appid:this.mAppSetting.getAppId(),timestamp:timeStamp+"",sign:sign},method:"POST",data:postJson});case 4:res=_context5.v;response=_.parseResponse(res);if(!(response.code===0)){_context5.n=7;break}logger.info1("get remote config success = ",response.data);_context5.n=5;return this.mAppSetting.updateAppConfigs(response.data);case 5:_context5.n=6;return tempSetting.updateRemoteConfigs(response);case 6:_context5.n=12;break;case 7:logger.info("get remote config fail with code = "+response.code+" msg = "+response.msg);if(!(response.code<0&&response.code>-100)){_context5.n=8;break}tempSetting.uploadDebugEvent(response.code);RemoteTimerTask.getInstance().removeSystemErrorTask(this.mAppSetting.getAppId(),tempSetting.getConfigTempCode());_context5.n=12;break;case 8:if(!(response.code<=-100&&response.code>=-200||response.code===-201)){_context5.n=11;break}retryCount--;if(!(retryCount>0)){_context5.n=10;break}logger.info("retry fetch after 3 seconds");_context5.n=9;return this.setTimeoutAsync(3e3);case 9:_context5.n=10;return this.fetchAsync(tempSetting,retryCount,postJson,isNeedControl);case 10:_context5.n=12;break;case 11:if(response.code===-202||response.code===-203){tempSetting.downGradeMode()}else if(response.code>=500&&response.code<600||response.code===Config.NETWORK_TIMEOUT);else if(response.code===Config.SIGN_ILLEGAL){AnalyticUtil.trackRiskEvent(this.mAppSetting.getAppId())}else{RemoteTimerTask.getInstance().removeSystemErrorTask(this.mAppSetting.getAppId(),tempSetting.getConfigTempCode())}case 12:return _context5.a(2)}}),_callee5,this)})));function fetchAsync(_x9,_x0,_x1,_x10){return _fetchAsync.apply(this,arguments)}return fetchAsync}()},{key:"setTimeoutAsync",value:function(){var _setTimeoutAsync=_asyncToGenerator(_regenerator().m((function _callee6(interval){return _regenerator().w((function(_context6){while(1)switch(_context6.n){case 0:return _context6.a(2,new Promise((function(resolve,_reject){setTimeout((function(){resolve(true)}),interval)})))}}),_callee6)})));function setTimeoutAsync(_x11){return _setTimeoutAsync.apply(this,arguments)}return setTimeoutAsync}()},{key:"obtainPostParams",value:function obtainPostParams(tempSetting,userInfo){var postJson={};postJson["appid"]=this.mAppSetting.getAppId();var localUserId=userInfo.userId;if(localUserId){postJson["local_user_id"]=localUserId}postJson["template_code"]=tempSetting.getTempCode();postJson["last_fetch_time"]=tempSetting.templateInfo.lastFetchStamp?tempSetting.templateInfo.lastFetchStamp+"":"0";var requestPramas={"#account_id":userInfo.accountId,"#distinct_id":userInfo.distinctId,"#client_user_id":userInfo.clientUserId,"#device_id":AnalyticUtil.getDeviceId()};_.extend(requestPramas,TDRemoteAPI.systemInfos);_.extend(requestPramas,tempSetting.getCustomParams());postJson["request_params"]=requestPramas;return postJson}},{key:"onTimerTaskCallBack",value:function onTimerTaskCallBack(code,obj){RemoteTaskQueue.getInstance().addTask(_asyncToGenerator(_regenerator().m((function _callee7(){var list,i,appId,tempCode,templateSetting,isExpired,_list,_i,_appId,_tempCode,_templateSetting;return _regenerator().w((function(_context7){while(1)switch(_context7.n){case 0:if(!(code===0||code===1)){_context7.n=5;break}list=[];if(code===0){list=RemoteTimerTask.getInstance().normalTasks}else if(code===1){list=RemoteTimerTask.getInstance().debugTasks}i=0;case 1:if(!(i<list.length)){_context7.n=4;break}appId=list[i].appId;tempCode=list[i].tempCode;if(!(appId===this.mAppSetting.getAppId())){_context7.n=3;break}templateSetting=this.mAppSetting.getTemplateSetting(tempCode);if(templateSetting){_context7.n=2;break}return _context7.a(3,3);case 2:isExpired=templateSetting.isExpired();if(isExpired){templateSetting.notifyConfigChanged()}if(!(isExpired||list[i].isDebug)){_context7.n=3;break}_context7.n=3;return this.fetchWithTempCode(tempCode,1,false);case 3:i++;_context7.n=1;break;case 4:_context7.n=11;break;case 5:if(!(code===2)){_context7.n=7;break}if(!(obj.appId===this.mAppSetting.getAppId())){_context7.n=6;break}_context7.n=6;return this.fetchWithTempCode(obj.tempCode,1,true);case 6:_context7.n=11;break;case 7:if(!(code===3)){_context7.n=11;break}_list=RemoteTimerTask.getInstance().normalTasks;_i=0;case 8:if(!(_i<_list.length)){_context7.n=11;break}_appId=_list[_i].appId;_tempCode=_list[_i].tempCode;if(!(_appId===this.mAppSetting.getAppId())){_context7.n=10;break}_templateSetting=this.mAppSetting.getTemplateSetting(_tempCode);if(_templateSetting){_context7.n=9;break}return _context7.a(3,10);case 9:if(!_templateSetting.isFetchExpired()){_context7.n=10;break}_context7.n=10;return this.fetchWithTempCode(_tempCode,1,true);case 10:_i++;_context7.n=8;break;case 11:return _context7.a(2)}}),_callee7,this)}))).bind(this))}},{key:"doAnalyticsObserver",value:function(){var _doAnalyticsObserver=_asyncToGenerator(_regenerator().m((function _callee0(type,obj){var clientUserId;return _regenerator().w((function(_context0){while(1)switch(_context0.n){case 0:if(!SystemConfig.getInstance().isRCCStop(this.mAppSetting.getAppId())){_context0.n=1;break}return _context0.a(2);case 1:if(!(type==="onAccountChanged")){_context0.n=3;break}_context0.n=2;return this.mAppSetting.getClientUserIdAsync(obj.accountId,obj.distinctId);case 2:clientUserId=_context0.v;RemoteTaskQueue.getInstance().addTask(_asyncToGenerator(_regenerator().m((function _callee9(){var _this=this;var changeInfo;return _regenerator().w((function(_context9){while(1)switch(_context9.n){case 0:_context9.n=1;return this.mAppSetting.doChangeAccount(obj.accountId,clientUserId);case 1:changeInfo=_context9.v;if(changeInfo.isChangeAccount){_context9.n=2;break}return _context9.a(2);case 2:logger.info("change account success with accountId = "+obj.accountId+" , distinctId = "+obj.distinctId);_.each(this.mAppSetting.templateSettings,function(){var _ref4=_asyncToGenerator(_regenerator().m((function _callee8(value,key){return _regenerator().w((function(_context8){while(1)switch(_context8.n){case 0:if(changeInfo.isFirstChange){_context8.n=1;break}_context8.n=1;return value.clearOldConfig();case 1:value.notifyConfigChanged(clientUserId);RemoteTimerTask.getInstance().removeDelayTemplateMessage(_this.mAppSetting.getAppId(),value.getConfigTempCode());_context8.n=2;return _this.fetchWithTempCode(key,1,true,obj.accountId,obj.distinctId);case 2:return _context8.a(2)}}),_callee8)})));return function(_x14,_x15){return _ref4.apply(this,arguments)}}());case 3:return _context9.a(2)}}),_callee9,this)}))).bind(this));case 3:return _context0.a(2)}}),_callee0,this)})));function doAnalyticsObserver(_x12,_x13){return _doAnalyticsObserver.apply(this,arguments)}return doAnalyticsObserver}()},{key:"doNetWorkChanged",value:function doNetWorkChanged(res){if(res&&res.isConnected){RemoteTaskQueue.getInstance().addTask(_asyncToGenerator(_regenerator().m((function _callee1(){var i;return _regenerator().w((function(_context1){while(1)switch(_context1.n){case 0:i=0;case 1:if(!(i<this.tempNetStatusList.length)){_context1.n=3;break}_context1.n=2;return this.fetchWithTempCode(self.tempNetStatusList[i],1,false);case 2:i++;_context1.n=1;break;case 3:this.tempNetStatusList=[];case 4:return _context1.a(2)}}),_callee1,this)}))).bind(this))}}}],[{key:"init",value:function init(config){config=_.checkSettings(config);if(!config)return;var instance=TDRemoteAPI._shareInstance(config.appId);if(instance){if(instance.mAppSetting.addTemplateCode(config)){instance._init(config)}}else{var api=new TDRemoteAPI(config);TDRemoteAPI.sInstanceMap[config.appId]=api;if(!TDRemoteAPI._defaultInstance){TDRemoteAPI._defaultInstance=api}api._init(config)}}},{key:"_shareInstance",value:function _shareInstance(appId){if(!TDRemoteAPI.sInstanceMap){TDRemoteAPI.sInstanceMap={}}if(TDRemoteAPI.sInstanceMap[appId]!==undefined){return TDRemoteAPI.sInstanceMap[appId]}else if(TDRemoteAPI._defaultInstance!==undefined){return TDRemoteAPI._defaultInstance}else{return undefined}}}])}();var TDRemoteConfig=function(){function TDRemoteConfig(){_classCallCheck(this,TDRemoteConfig)}return _createClass(TDRemoteConfig,null,[{key:"init",value:function init(config){TDRemoteAPI.init(config)}},{key:"setDefaultValues",value:function setDefaultValues(defaultValues,appId){var api=TDRemoteAPI._shareInstance(appId);if(api){api.applyDefaultParams(defaultValues)}}},{key:"setDefaultValuesWithJsonFile",value:function setDefaultValuesWithJsonFile(path,appId){var api=TDRemoteAPI._shareInstance(appId);if(api){api.applyDefaultParamsWithJsonFile(path)}}},{key:"clearDefaultValues",value:function clearDefaultValues(appId){var api=TDRemoteAPI._shareInstance(appId);if(api){api.clearDefaultParams()}}},{key:"setCustomFetchParams",value:function setCustomFetchParams(fetchParams,appId,tempCode){var api=TDRemoteAPI._shareInstance(appId);if(api){api.setCustomFetchParams(fetchParams,tempCode)}}},{key:"removeCustomFetchParam",value:function removeCustomFetchParam(key,appId,tempCode){var api=TDRemoteAPI._shareInstance(appId);if(api){api.removeCustomFetchParams(key,tempCode)}}},{key:"fetch",value:function fetch(appId,tempCode){var api=TDRemoteAPI._shareInstance(appId);if(api){RemoteTaskQueue.getInstance().addTask(_asyncToGenerator(_regenerator().m((function _callee(){return _regenerator().w((function(_context){while(1)switch(_context.n){case 0:api.fetchWithTempCode(tempCode,1,true);case 1:return _context.a(2)}}),_callee)}))))}}},{key:"setLogPrintListener",value:function setLogPrintListener(listener){logger.listener=listener}},{key:"addConfigFetchListener",value:function addConfigFetchListener(listener){var api=TDRemoteAPI._shareInstance();if(api){return api.addConfigFetchListener(listener)}}},{key:"getData",value:function getData(appId,tempCode){var api=TDRemoteAPI._shareInstance(appId);var values;if(api){values=api.getAll(tempCode)}return new TDObject(values)}}])}();PlatformAPI.setGlobalData(TDRemoteConfig);export default TDRemoteConfig;